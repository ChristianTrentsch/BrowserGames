"use strict";import{GameObject as I}from"../../GameObject.js";import{resources as m}from"../../Resource.js";import{Vector2 as o}from"../../Vector2.js";import{Sprite as p}from"../../Sprite.js";import{getCharacterFrame as l,getCharacterWidth as S}from"./spriteFontMap.js";import{events as b,TEXTBOX_END as N}from"../../Events.js";export class SpriteTextString extends I{constructor(i,e){super(new o(16,96)),this.drawLayer="HUD";const s=e??"Default";this.words=s.split(" ").map(r=>{let n=0;const a=r.split("").map(h=>{const t=S(h);return n+=t,{width:t,sprite:new p({position:new o(0,0),resource:m.images.fontWhite,hFrames:13,vFrames:6,frame:l(h)})}});return{wordWidth:n,chars:a}}),this.backdrop=new p({position:new o(0,0),resource:m.images.textBox,frameSize:new o(256,64)}),this.portrait=new p({position:new o(0,0),resource:m.images.portraits,hFrames:4,frame:i??0}),this.showingIndex=0,this.finalIndex=this.words.reduce((r,n)=>r+n.chars.length,0),this.textSpeed=80,this.timeUntilNextShow=this.textSpeed}step(i,e){if(e.input?.getActionJustPressed("Space")){if(this.showingIndex<this.finalIndex){this.showingIndex=this.finalIndex;return}b.emit(N)}this.timeUntilNextShow-=i,this.timeUntilNextShow<=0&&(this.showingIndex+=1,this.timeUntilNextShow=this.textSpeed)}drawImage(i,e,s){this.backdrop.drawImage(i,e,s);const r=7,n=5,a=240,h=14;let t=e+r,c=s+n,d=0;this.words.forEach(w=>{e+a-t<w.wordWidth&&(t=e+r,c+=h),w.chars.forEach(u=>{if(d>this.showingIndex)return;const{sprite:f,width:x}=u,g=t-5;f.draw(i,g,c),t+=x,t+=1,d+=1}),t+=3})}}
