"use strict";import{GameObject as I}from"../../GameObject.js";import{resources as m}from"../../Resource.js";import{Vector2 as o}from"../../Vector2.js";import{Sprite as p}from"../../Sprite.js";import{getCharacterFrame as l,getCharacterWidth as S}from"./spriteFontMap.js";import{events as b,TEXTBOX_END as N}from"../../Events.js";export class SpriteTextString extends I{constructor(i,t){super(new o(16,96)),this.drawLayer="HUD";const r=t??"Default";this.words=r.split(" ").map(n=>{let s=0;const a=n.split("").map(h=>{const e=S(h);return s+=e,{width:e,sprite:new p({position:new o(0,0),resource:m.images.fontWhite,hFrames:13,vFrames:6,frame:l(h)})}});return{wordWidth:s,chars:a}}),this.backdrop=new p({position:new o(0,0),resource:m.images.textBox,frameSize:new o(256,64)}),this.portrait=new p({position:new o(0,0),resource:m.images.portraits,hFrames:4,vFrames:1,frame:i??0}),this.showingIndex=0,this.finalIndex=this.words.reduce((n,s)=>n+s.chars.length,0),this.textSpeed=80,this.timeUntilNextShow=this.textSpeed}step(i,t){if(t.input?.getActionJustPressed("Space")){if(this.showingIndex<this.finalIndex){this.showingIndex=this.finalIndex;return}b.emit(N)}this.timeUntilNextShow-=i,this.timeUntilNextShow<=0&&(this.showingIndex+=1,this.timeUntilNextShow=this.textSpeed)}drawImage(i,t,r){this.backdrop.drawImage(i,t,r),this.portrait.drawImage(i,t+6,r+6);const n=27,s=9,a=240,h=14;let e=t+n,c=r+s,d=0;this.words.forEach(u=>{t+a-e<u.wordWidth&&(e=t+n,c+=h),u.chars.forEach(w=>{if(d>this.showingIndex)return;const{sprite:f,width:x}=w,g=e-5;f.draw(i,g,c),e+=x,e+=1,d+=1}),e+=3})}}
