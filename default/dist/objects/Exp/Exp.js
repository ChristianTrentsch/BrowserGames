"use strict";import{events as p,HERO_CHANGE_EXP as c}from"../../Events.js";import{GameObject as d}from"../../GameObject.js";import{resources as o}from"../../Resource.js";import{SaveGame as f}from"../../SaveGame.js";import{Sprite as s}from"../../Sprite.js";import{Vector2 as r}from"../../Vector2.js";import{LEVEL_THRESHOLDS as x}from"../Hero/Hero.js";import{getCharacterFrame as w,getCharacterWidth as v}from"../SpriteTextString/spriteFontMap.js";export class Exp extends d{constructor(){super(new r(21,130)),this.drawLayer="HUD";const e=f.loadHero();this.exp=e?.exp?e.exp:0,this.level=e?.level?e.level:0,this.heroPos=e?.pos?e.pos:new r,this.renderExp()}ready(){p.on(c,this,e=>{this.exp=e.exp,this.level=e.level,this.heroPos=e.heroPos,this.renderExp()})}renderExp(){if(this.children.forEach(i=>i.destroy()),this.addChild(new s({resource:o.images.expBackground,position:new r(-2,-11),frameSize:new r(240,24),frame:0})),this.addChild(new s({resource:o.images.levelBackground,position:new r(-32,-3),frameSize:new r(31,31)})),this.addChild(new s({position:new r(-30,-1),resource:o.images.portraits})),this.level>0){const i=String(this.level);let n=-23;const m=16;for(const a of i){const h=v(a),t=new s({position:new r(n,m),resource:o.images.fontWhite,hFrames:13,vFrames:6,frame:w(a)});this.addChild(t),n+=h+1}}const e=x[this.level];if(e){const n=this.exp/e,m=Math.min(n,1);let a=Math.floor(m*234);const h=1;for(let t=0;t<a;t++){const l=t*h;this.addChild(new s({resource:o.images.exp,position:new r(l+1,0),frameSize:new r(h,2),hFrames:240,frame:t}))}}}}
