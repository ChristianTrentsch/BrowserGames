"use strict";import{events as h,HERO_CHANGE_EQUIPMENT as v,HERO_PICKS_UP_ITEM as I}from"../../Events.js";import{GameObject as l}from"../../GameObject.js";import{resources as r}from"../../Resource.js";import{SaveGame as o}from"../../SaveGame.js";import{Sprite as c}from"../../Sprite.js";import{Vector2 as m}from"../../Vector2.js";import{SWORD as d,ROD_PURPLE as p,ROD_RED as f,Item as x}from"../Item/Item.js";export const EQUIPMENT_ITEMS=[d,p,f];export class Equipment extends l{constructor(){super(new m(20,135)),this.drawLayer="HUD",this.nextId=0,this.items=o.loadEquipment(),this.nextId=Math.max(0,...this.items.map(t=>t.id)),this.renderEquipment()}ready(){h.on(I,this,t=>{const{name:n}=t;!this.items.find(e=>e.name===n)&&EQUIPMENT_ITEMS.includes(n)&&(this.items.forEach(e=>e.active=!1),this.nextId+=1,this.items.push({id:this.nextId,name:n,amount:1,active:!0})),o.saveEquipment(this.items.map(e=>({id:e.id,name:e.name,amount:e.amount,active:e.active}))),this.renderEquipment()}),h.on(v,this,()=>{const n=(this.items.findIndex(i=>i.active===!0)+1)%this.items.length;this.items.forEach(i=>i.active=!1),this.items[n].active=!0,o.saveEquipment(this.items.map(i=>({id:i.id,name:i.name,amount:i.amount,active:i.active}))),this.renderEquipment()})}renderEquipment(){this.children.forEach(e=>e.destroy());const t=24,n=.01,i=0;for(let e=0;e<10;e++){const s=e*t;this.addChild(new c({resource:r.images.equipment,position:new m(s,i-n),frameSize:new m(t,t),hFrames:25,vFrames:1,frame:e}))}this.items.forEach((e,s)=>{const u=s*t;if(e.active===!0){let a=10+s;a>=20&&(a=10),this.addChild(new c({resource:r.images.equipment,position:new m(u,i),frameSize:new m(t,t),hFrames:25,vFrames:1,frame:a}))}const E=x.getCollectibleItemFrame(e.name);this.addChild(new c({resource:r.images.collectible,position:new m(u+4,i+4),hFrames:20,frame:E}))})}removeFromEquipment(t){this.items=this.items.filter(n=>n.name!==t),this.renderEquipment()}getActiveDamage(){const t=this.items.find(n=>n.active);if(!t)return 1;switch(t.name){case d:return 1;case p:return 2;case f:return 5;default:return 1}}}
