"use strict";import{events as d,HERO_CHANGE_EQUIPMENT as c,HERO_PICKS_UP_ITEM as p}from"../../Events.js";import{GameObject as h}from"../../GameObject.js";import{resources as n}from"../../Resource.js";import{SaveGame as a}from"../../SaveGame.js";import{Sprite as r}from"../../Sprite.js";import{Vector2 as s}from"../../Vector2.js";export const EQUIPMENT_ITEMS=["sword","rodPurple","rodRed","rodAttackPurple","rodAttackRed"];export class Equipment extends h{constructor(){super(new s(1,153)),this.drawLayer="HUD",this.nextId=0,this.items=a.loadEquipment().map(e=>({...e,image:n.images[e.imageKey]})),this.items.length<=0&&(this.nextId+=1,this.items.push({id:this.nextId,image:n.images.sword,imageKey:"sword",amount:1,active:!0})),this.nextId=Math.max(0,...this.items.map(e=>e.id)),this.renderEquipment()}ready(){d.on(p,this,e=>{const{imageKey:i}=e;!this.items.find(m=>m.imageKey===i)&&EQUIPMENT_ITEMS.includes(i)&&(this.nextId+=1,this.items.push({id:this.nextId,image:n.images[i],imageKey:i,amount:1,active:!1})),a.saveEquipment(this.items.map(m=>({id:m.id,imageKey:m.imageKey,amount:m.amount,active:m.active}))),this.renderEquipment()}),d.on(c,this,()=>{const i=(this.items.findIndex(t=>t.active===!0)+1)%this.items.length;this.items.forEach(t=>t.active=!1),this.items[i].active=!0,a.saveEquipment(this.items.map(t=>({id:t.id,imageKey:t.imageKey,amount:t.amount,active:t.active}))),this.renderEquipment()})}renderEquipment(){this.children.forEach(e=>e.destroy()),this.items.forEach((e,i)=>{const t=i*25,m=0;let o=new r({resource:n.images.equipmentItemFrame,position:new s(t,m),frameSize:new s(24,24)});e.active===!0&&(o=new r({resource:n.images.equipmentActiveFrame,position:new s(t,m),frameSize:new s(24,24)})),this.addChild(o);let u=new r({resource:n.images[e.imageKey],position:new s(t+4,m+4)});e.imageKey==="sword"&&(u=new r({resource:n.images[e.imageKey],position:new s(t-2,m+2),frameSize:new s(32,32),hFrames:6,vFrames:4,frame:18})),this.addChild(u)})}removeFromEquipment(e){this.items=this.items.filter(i=>i.imageKey!==e),this.renderEquipment()}getActiveDamage(){const e=this.items.find(i=>i.active);if(!e)return 1;switch(e.imageKey){case"sword":return 1;case"rodPurple":return 2;case"rodRed":return 5;default:return 1}}}
