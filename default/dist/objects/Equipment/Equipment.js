"use strict";import{events as p,HERO_CHANGE_EQUIPMENT as h,HERO_PICKS_UP_ITEM as f}from"../../Events.js";import{GameObject as E}from"../../GameObject.js";import{resources as a}from"../../Resource.js";import{SaveGame as d}from"../../SaveGame.js";import{Sprite as u}from"../../Sprite.js";import{Vector2 as n}from"../../Vector2.js";export const EQUIPMENT_ITEMS=["sword","rodPurple","rodRed","rodAttackPurple","rodAttackRed"];export class Equipment extends E{constructor(){super(new n(20,135)),this.drawLayer="HUD",this.nextId=0,this.items=d.loadEquipment().map(e=>({...e,image:a.images[e.name]})),this.items.length<=0&&(this.nextId+=1,this.items.push({id:this.nextId,name:"sword",amount:1,active:!0})),this.nextId=Math.max(0,...this.items.map(e=>e.id)),this.renderEquipment()}ready(){p.on(f,this,e=>{const{imageKey:m}=e;!this.items.find(t=>t.name===m)&&EQUIPMENT_ITEMS.includes(m)&&(this.nextId+=1,this.items.push({id:this.nextId,name:m,amount:1,active:!1})),d.saveEquipment(this.items.map(t=>({id:t.id,name:t.name,amount:t.amount,active:t.active}))),this.renderEquipment()}),p.on(h,this,()=>{const m=(this.items.findIndex(i=>i.active===!0)+1)%this.items.length;this.items.forEach(i=>i.active=!1),this.items[m].active=!0,d.saveEquipment(this.items.map(i=>({id:i.id,name:i.name,amount:i.amount,active:i.active}))),this.renderEquipment()})}renderEquipment(){this.children.forEach(t=>t.destroy());const e=24,m=.01,i=0;for(let t=0;t<10;t++){const s=t*e;this.addChild(new u({resource:a.images.equipment,position:new n(s,i-m),frameSize:new n(e,e),hFrames:25,vFrames:1,frame:t}))}this.items.forEach((t,s)=>{const c=s*e;if(t.active===!0){let o=10+s;o>=20&&(o=10),this.addChild(new u({resource:a.images.equipment,position:new n(c,i),frameSize:new n(e,e),hFrames:25,vFrames:1,frame:o}))}let r;switch(t.name){case"sword":r=20;break;case"rodPurple":r=21;break;case"rodRed":r=22;break;default:r=20;break}this.addChild(new u({resource:a.images.equipment,position:new n(c,i+m),frameSize:new n(e,e),hFrames:25,vFrames:1,frame:r}))})}removeFromEquipment(e){this.items=this.items.filter(m=>m.name!==e),this.renderEquipment()}getActiveDamage(){const e=this.items.find(m=>m.active);if(!e)return 1;switch(e.name){case"sword":return 1;case"rodPurple":return 2;case"rodRed":return 5;default:return 1}}}
