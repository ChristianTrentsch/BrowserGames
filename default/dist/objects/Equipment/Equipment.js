"use strict";import{events as h,HERO_CHANGE_EQUIPMENT as p,HERO_PICKS_UP_ITEM as E}from"../../Events.js";import{GameObject as f}from"../../GameObject.js";import{resources as o}from"../../Resource.js";import{SaveGame as c}from"../../SaveGame.js";import{Sprite as u}from"../../Sprite.js";import{Vector2 as s}from"../../Vector2.js";export const EQUIPMENT_SWORD="sword",EQUIPMENT_ROD_PURPLE="rodPurple",EQUIPMENT_ROD_RED="rodRed",EQUIPMENT_ITEMS=[EQUIPMENT_SWORD,EQUIPMENT_ROD_PURPLE,EQUIPMENT_ROD_RED];export class Equipment extends f{constructor(){super(new s(20,135)),this.drawLayer="HUD",this.nextId=0,this.items=c.loadEquipment(),this.nextId=Math.max(0,...this.items.map(e=>e.id)),this.renderEquipment()}ready(){h.on(E,this,e=>{const{name:n}=e;!this.items.find(t=>t.name===n)&&EQUIPMENT_ITEMS.includes(n)&&(this.items.forEach(t=>t.active=!1),this.nextId+=1,this.items.push({id:this.nextId,name:n,amount:1,active:!0})),c.saveEquipment(this.items.map(t=>({id:t.id,name:t.name,amount:t.amount,active:t.active}))),this.renderEquipment()}),h.on(p,this,()=>{const n=(this.items.findIndex(i=>i.active===!0)+1)%this.items.length;this.items.forEach(i=>i.active=!1),this.items[n].active=!0,c.saveEquipment(this.items.map(i=>({id:i.id,name:i.name,amount:i.amount,active:i.active}))),this.renderEquipment()})}renderEquipment(){this.children.forEach(t=>t.destroy());const e=24,n=.01,i=0;for(let t=0;t<10;t++){const a=t*e;this.addChild(new u({resource:o.images.equipment,position:new s(a,i-n),frameSize:new s(e,e),hFrames:25,vFrames:1,frame:t}))}this.items.forEach((t,a)=>{const d=a*e;if(t.active===!0){let r=10+a;r>=20&&(r=10),this.addChild(new u({resource:o.images.equipment,position:new s(d,i),frameSize:new s(e,e),hFrames:25,vFrames:1,frame:r}))}let m;switch(t.name){case EQUIPMENT_SWORD:m=20;break;case EQUIPMENT_ROD_PURPLE:m=21;break;case EQUIPMENT_ROD_RED:m=22;break;default:m=20;break}this.addChild(new u({resource:o.images.equipment,position:new s(d,i+n),frameSize:new s(e,e),hFrames:25,vFrames:1,frame:m}))})}removeFromEquipment(e){this.items=this.items.filter(n=>n.name!==e),this.renderEquipment()}getActiveDamage(){const e=this.items.find(n=>n.active);if(!e)return 1;switch(e.name){case EQUIPMENT_SWORD:return 1;case EQUIPMENT_ROD_PURPLE:return 2;case EQUIPMENT_ROD_RED:return 5;default:return 1}}}
