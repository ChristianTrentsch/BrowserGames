"use strict";import{GameObject as s}from"../../GameObject.js";import{Camera as a}from"../../Camera.js";import{Input as l}from"../../Input.js";import{Inventory as m}from"../Inventory/Inventory.js";import{events as o,CHANGE_LEVEL as d,HERO_REQUESTS_ACTION as f,TEXTBOX_START as p,TEXTBOX_END as v,HERO_ATTACK_ACTION as h}from"../../Events.js";import{SpriteTextString as C}from"../SpriteTextString/SpriteTextString.js";import{Vector2 as u}from"../../Vector2.js";import{SaveGame as c}from"../../SaveGame.js";import{Tree as g}from"../../levels/parts/Tree/Tree.js";import{Bush as x}from"../../levels/parts/Bush/Bush.js";import{Stone as T}from"../../levels/parts/Stone/Stone.js";export class Main extends s{constructor(t){super(t),this.level=null,this.input=new l,this.camera=new a(new u(0,0))}ready(){const t=new m;this.addChild(t),o.on(d,this,e=>{c.saveLevel(e.levelId),this.setLevel(e)}),o.on(f,this,e=>{if(typeof e.getContent=="function"){const n=e.getContent(),r=new C(n.portraitFrame,n.string);this.addChild(r),o.emit(p);const i=o.on(v,this,()=>{r.destroy(),o.off(i)})}}),o.on(h,this,e=>{(e instanceof g||e instanceof T||e instanceof x)&&(e.healthPoints-=1)})}setLevel(t){this.level&&this.level.destroy(),this.level=t,this.addChild(this.level)}drawBackground(t){this.level&&this.level.background.drawImage(t,this.level.background.position.x,this.level.background.position.x)}drawObjects(t){this.children.forEach(e=>{e.drawLayer!=="HUD"&&e.draw(t,e.position.x,e.position.x)})}drawForeground(t){this.children.forEach(e=>{e.drawLayer==="HUD"&&e.draw(t,e.position.x,e.position.x)})}}
