"use strict";import{GameObject as a}from"../../GameObject.js";import{Camera as l}from"../../Camera.js";import{Input as p}from"../../Input.js";import{Inventory as v}from"../Inventory/Inventory.js";import{events as t,CHANGE_LEVEL as d,HERO_REQUESTS_ACTION as u,TEXTBOX_START as m,TEXTBOX_END as h,HERO_ATTACK_ACTION as f}from"../../Events.js";import{SpriteTextString as c}from"../SpriteTextString/SpriteTextString.js";import{Vector2 as R}from"../../Vector2.js";import{SaveGame as r}from"../../SaveGame.js";import{Tree as x}from"../../levels/parts/Tree/Tree.js";import{Bush as C}from"../../levels/parts/Bush/Bush.js";import{Stone as y}from"../../levels/parts/Stone/Stone.js";export class Main extends a{constructor(o){super(o),this.level=null,this.input=new p,this.camera=new l(new R(0,0)),this.savedResources=[]}ready(){const o=new v;this.addChild(o),t.on(d,this,e=>{r.saveLevel(e.levelId),this.setLevel(e)}),t.on(u,this,e=>{if(typeof e.getContent=="function"){const s=e.getContent(),n=new c(s.portraitFrame,s.string);this.addChild(n),t.emit(m);const i=t.on(h,this,()=>{n.destroy(),t.off(i)})}}),t.on(f,this,e=>{(e instanceof x||e instanceof y||e instanceof C)&&(e.healthPoints-=1,this.level&&(this.pushResource(e),r.saveResources(this.level.levelId,this.savedResources)))})}pushResource(o){const e=this.savedResources.find(s=>s.type===o.constructor.name&&s.x===o.position.x&&s.y===o.position.y);e?e.hp=o.healthPoints:this.savedResources.push({type:o.constructor.name,x:o.position.x,y:o.position.y,hp:o.healthPoints})}setLevel(o){this.level&&this.level.destroy(),this.level=o,this.addChild(this.level),this.savedResources=r.loadResources(this.level.levelId)??[]}drawBackground(o){this.level&&this.level.background.drawImage(o,this.level.background.position.x,this.level.background.position.x)}drawObjects(o){this.children.forEach(e=>{e.drawLayer!=="HUD"&&e.draw(o,e.position.x,e.position.x)})}drawForeground(o){this.children.forEach(e=>{e.drawLayer==="HUD"&&e.draw(o,e.position.x,e.position.x)})}}
