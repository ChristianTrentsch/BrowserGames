"use strict";import{CHANGE_LEVEL as n,events as h,HERO_SHOW_MAP as d}from"../../Events.js";import{GameObject as m}from"../../GameObject.js";import{resources as r}from"../../Resource.js";import{SaveGame as c}from"../../SaveGame.js";import{Sprite as t}from"../../Sprite.js";import{Vector2 as e}from"../../Vector2.js";import{Hero as S}from"../Hero/Hero.js";export class LevelMap extends m{constructor(){super(new e(-52,0));this.isVisible=!1;this.mapScale=.14;this.mapShell=null;this.levelId=c.loadLevel()}ready(){h.on(n,this,i=>{this.isVisible=!1,this.levelId=i.levelId,this.hideMap()}),h.on(d,this,i=>{this.isVisible=!this.isVisible,this.isVisible?this.showMap(i.position):this.hideMap()})}step(i,l){if(this.isVisible&&this.heroMarker&&l.level){const s=l.level.children.find(a=>a instanceof S);s&&(this.heroMarker.position.x=s.position.x*this.mapScale-32*this.mapScale,this.heroMarker.position.y=s.position.y*this.mapScale-32*this.mapScale)}}showMap(i){let l=r.images.outdoorGround,s=new e(22,17),a=21,o=new e(181,24);switch(this.levelId){case"CaveLevel1":l=r.images.desertGround,s=new e(22,17),a=22,o=new e(72,72);break}this.mapShell=new m(i),this.mapShell.addChild(new t({position:new e(0,0),resource:l,frameSize:new e(1600,800),scale:this.mapScale})),this.mapShell.addChild(new t({resource:r.images.equipment,position:s,frameSize:new e(24,24),frame:a,hFrames:30,scale:this.mapScale*5})),this.mapShell.addChild(new t({resource:r.images.exit,position:o,scale:this.mapScale*5}));const p=new e(i.x*this.mapScale,i.y*this.mapScale);this.heroMarker=new t({resource:r.images.mapMarker,position:p,scale:this.mapScale*5}),this.mapShell.addChild(this.heroMarker),this.addChild(this.mapShell)}hideMap(){this.heroMarker&&(this.removeChild(this.heroMarker),this.heroMarker=null),this.mapShell&&(this.removeChild(this.mapShell),this.mapShell=null)}}
