"use strict";import{gridCells as e,TILE_SIZE as o}from"../helpers/grid.js";import{resources as y}from"../Resource.js";import{Vector2 as t}from"../Vector2.js";import{Sprite as m}from"../Sprite.js";import{Level as c}from"../objects/Level/Level.js";import{Exit as f}from"../objects/Exit/Exit.js";import{Hero as g}from"../objects/Hero/Hero.js";import{BUSH as S,Item as L,STONE as v,TREE as R}from"../objects/Item/Item.js";import{events as u,HERO_EXITS as k,CHANGE_LEVEL as W}from"../Events.js";import{CaveLevel1 as b}from"./CaveLevel1.js";import{SaveGame as d}from"../SaveGame.js";import{Tree as C}from"./parts/Tree/Tree.js";import{Stone as I}from"./parts/Stone/Stone.js";import{Square as a}from"./parts/Square/Square.js";import{Water as w}from"./parts/Water/Water.js";import{Bush as T}from"./parts/Bush/Bush.js";import{House as P}from"./parts/House/House.js";import{generateDefaultResources as _,generateDeko as E}from"../helpers/generateResources.js";import{Npc as G}from"../objects/Npc/Npc.js";import{Deko as l}from"../objects/Animations/Deko.js";export class OutdoorLevel1 extends c{constructor(r){super(r,"./sounds/levels/background_music_02.mp3",.2);this.levelId="OutdoorLevel1";this.defaultHeroPosition=new t(e(60),e(21));this.initBackgroundSound(),this.background=new m({resource:y.images.outdoorSky,frameSize:new t(320,180),position:new t(0,0)});const i=new m({resource:y.images.outdoorGround,frameSize:new t(1600,800),position:new t(0,0)});this.addChild(i),this.checkGameProgress(),this.buildLevelGroupPurpleRod(),this.buildLevelGroupExit(),this.loadLevelResources(),this.loadLevelDeko(),this.loadStartLake(),this.addChild(new l(new t(e(48)-1,e(22)+8),"animTorch")),this.addChild(new l(new t(e(51)+2,e(26)-4),"animTorch")),this.addChild(new l(new t(e(49),e(25)),"animBushSmall",7e3)),this.heroStartPosition=this.defaultHeroPosition;const s=d.loadHero();let n=0,h=0;s&&(this.heroStartPosition=s.pos??this.defaultHeroPosition,n=s.exp,h=s.level);const x=new g(this.heroStartPosition.x,this.heroStartPosition.y,n,h);this.addChild(x);const p={right:this.generateWall(new t(1568,32),new t(1568,764),o,"right"),left:this.generateWall(new t(16,32),new t(16,764),o,"left"),top:this.generateWall(new t(32,16),new t(1568,16),o,"top"),bottom:this.generateWall(new t(32,768),new t(1568,768),o,"bottom"),startIslandTop1:this.generateWall(new t(e(48),e(22)),new t(e(51),e(22)),o,"top"),startIslandTop2:this.generateWall(new t(e(52),e(23)),new t(e(57),e(23)),o,"top"),startIslandTop3:this.generateWall(new t(e(44),e(24)),new t(e(46),e(24)),o,"top"),startIslandTop4:this.generateWall(new t(e(44),e(26)),new t(e(46),e(26)),o,"top"),startIslandLeft1:this.generateWall(new t(e(47),e(23)),new t(e(47),e(24)),o,"left"),startIslandLeft2:this.generateWall(new t(e(47),e(26)),new t(e(47),e(26)),o,"left"),startIslandRight1:this.generateWall(new t(e(52),e(26)),new t(e(52),e(26)),o,"right"),startIslandBottom1:this.generateWall(new t(e(48),e(27)),new t(e(51),e(27)),o,"bottom"),startIslandBottom2:this.generateWall(new t(e(52),e(25)),new t(e(57),e(25)),o,"bottom"),startLakeTop1:this.generateWall(new t(e(43),e(19)),new t(e(58),e(19)),o,"top"),startLakeBottom1:this.generateWall(new t(e(43),e(29)),new t(e(58),e(29)),o,"bottom"),startLakeLeft1:this.generateWall(new t(e(43),e(20)),new t(e(43),e(24)),o,"left"),startLakeLeft2:this.generateWall(new t(e(43),e(26)),new t(e(43),e(28)),o,"left"),startLakeRight1:this.generateWall(new t(e(58),e(20)),new t(e(58),e(23)),o,"right"),startLakeRight2:this.generateWall(new t(e(58),e(25)),new t(e(58),e(28)),o,"right")};this.walls=new Set(Object.values(p).flat())}ready(){u.on(k,this,()=>{this.stopBackgroundSound();const r=new t(e(35),e(33)),i=d.loadHero();i&&(d.saveHero(i.level,r,i.exp),u.emit(W,new b(new t(0,0))))})}buildLevelGroupPurpleRod(){let r=new G(e(5),e(8),[{string:"Du hast nun die st\xE4rkste Waffe und keine Resource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Danke f\xFCr das Holz. Jetzt kannst du noch schneller Resourcen sammeln!  Sprich mit meinem Bruder wenn du Zeit findest.",requires:["STORY_01_PART_01"]},{string:"Bringe mir 5x Holz und ich gebe dir einen Zauberstab der mehr Schaden austeilt!",storyFlag:"STORY_01_PART_01"}]);d.isInEquipment("rodPurple")&&(r.position.x+=e(-1));const i=[r,new a(e(4),e(3)),new a(e(5),e(3)),new a(e(6),e(3)),new a(e(4),e(7)),new a(e(6),e(7)),new a(e(3),e(4)),new a(e(3),e(5)),new a(e(3),e(6)),new a(e(7),e(4)),new a(e(7),e(5)),new a(e(7),e(6))];if(!d.isInEquipment("rodPurple")){const s=new L(e(5),e(5),"rodPurple");i.push(s)}this.addChildrenGroup("lila Zauberstab",e(8),e(8),i,[{x1:4,x2:6,y1:0,y2:0},{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:0,x2:10,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}buildLevelGroupExit(){const r=[new f(e(3),e(3)),new P(e(7),e(6)),new w(e(3),e(6)),new w(e(4),e(6)),new w(e(5),e(6)),new w(e(6),e(6))];this.addChildrenGroup("Exit Gruppe",e(80),e(10),r,[{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:2,x2:8,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}loadLevelResources(){const r=_({levelId:"OutdoorLevel1",width:1600,height:800,seed:3,pathZones:[...this.noResourceZones,{x1:41,x2:48,y1:17,y2:17},{x1:41,x2:60,y1:18,y2:19},{x1:40,x2:61,y1:20,y2:28},{x1:41,x2:58,y1:29,y2:29},{x1:41,x2:53,y1:30,y2:30},{x1:42,x2:49,y1:31,y2:31},{x1:68,x2:80,y1:24,y2:25},{x1:25,x2:37,y1:23,y2:25},{x1:25,x2:26,y1:26,y2:39},{x1:8,x2:24,y1:40,y2:41},{x1:8,x2:9,y1:22,y2:39},{x1:10,x2:14,y1:22,y2:23}],density:{Tree:.5,Bush:.2,Stone:.1},border:32}),i=d.loadResources(this.levelId),s=r.map(n=>{const h=i.find(x=>x.x===n.x&&x.y===n.y&&x.type===n.type);return h?{...n,...h}:n});for(const n of s)if(n.hp>0)switch(n.type){case S:this.addChild(new T(n.x,n.y,n.hp));break;case R:this.addChild(new C(n.x,n.y,n.hp));break;case v:this.addChild(new I(n.x,n.y,n.hp));break}}loadLevelDeko(){const r=E({levelId:"OutdoorLevel1",width:1600,height:800,seed:2,pathZones:[...this.noResourceZones,{x1:41,x2:48,y1:17,y2:17},{x1:41,x2:60,y1:18,y2:19},{x1:40,x2:61,y1:20,y2:28},{x1:41,x2:58,y1:29,y2:29},{x1:41,x2:53,y1:30,y2:30},{x1:42,x2:49,y1:31,y2:31},{x1:68,x2:80,y1:24,y2:25},{x1:25,x2:37,y1:23,y2:25},{x1:25,x2:26,y1:26,y2:39},{x1:8,x2:24,y1:40,y2:41},{x1:8,x2:9,y1:22,y2:39},{x1:10,x2:14,y1:22,y2:23}],density:{animBushSmall:.02,animBush:.01},border:32});for(const i of r)this.addChild(new l(new t(i.x,i.y),i.type,this.getRandomDelay()))}getRandomDelay(r=4,i=7){const s=r*1e3,n=i*1e3;return Math.random()*(n-s)+s}loadStartLake(){this.addChild(new l(new t(e(43),e(19)),"animWaterLeft"));for(let r=44;r<58;r++)this.addChild(new l(new t(e(r),e(19)),"animWaterMiddle"));this.addChild(new l(new t(e(58),e(19)),"animWaterRight")),this.addChild(new l(new t(e(48),e(27)),"animWaterLeft")),this.addChild(new l(new t(e(49),e(27)),"animWaterMiddle")),this.addChild(new l(new t(e(50),e(27)),"animWaterMiddle")),this.addChild(new l(new t(e(51),e(27)),"animWaterRight"))}}
