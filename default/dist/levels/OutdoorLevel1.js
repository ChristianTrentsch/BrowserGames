"use strict";import{gridCells as e,TILE_SIZE as o}from"../helpers/grid.js";import{resources as l}from"../Resource.js";import{Vector2 as r}from"../Vector2.js";import{Sprite as u}from"../Sprite.js";import{Level as k}from"../objects/Level/Level.js";import{Exit as v}from"../objects/Exit/Exit.js";import{Hero as C}from"../objects/Hero/Hero.js";import{Item as x}from"../objects/Item/Item.js";import{events as m,HERO_EXITS as b,CHANGE_LEVEL as O}from"../Events.js";import{CaveLevel1 as I}from"./CaveLevel1.js";import{SaveGame as i}from"../SaveGame.js";import{Tree as A}from"./parts/Tree/Tree.js";import{Stone as E}from"./parts/Stone/Stone.js";import{Square as n}from"./parts/Square/Square.js";import{Water as d}from"./parts/Water/Water.js";import{Bush as H}from"./parts/Bush/Bush.js";import{House as L}from"./parts/House/House.js";import{generateDefaultResources as Y}from"../helpers/generateResources.js";import{Npc as c}from"../objects/Npc/Npc.js";import{storyFlags as p}from"../StoryFlags.js";export class OutdoorLevel1 extends k{constructor({position:f,heroPosition:w}){super(f,"./sounds/levels/background_music_02.mp3",.2);this.defaultHeroPosition=new r(e(8),e(4));this.levelId="OutdoorLevel1";this.initBackgroundSound(),this.background=new u({resource:l.images.outdoorSky,frameSize:new r(320,180),position:new r(0,0)});const S=new u({resource:l.images.outdoorGround,frameSize:new r(1600,900),position:new r(0,0)});this.addChild(S);const _=Y({levelId:"OutdoorLevel1",width:1600,height:900,seed:3,pathZones:[{x1:0,x2:100,y1:20,y2:24},{x1:45,x2:55,y1:0,y2:56},{x1:0,x2:14,y1:0,y2:7}],density:{Tree:.2,Bush:.1,Stone:.02},border:48}),g=i.loadResources(this.levelId),R=_.map(t=>{const h=g.find(s=>s.x===t.x&&s.y===t.y&&s.type===t.type);return h?{...t,...h}:t});for(const t of R)if(t.hp>0)switch(t.type){case"Tree":this.addChild(new A(t.x,t.y,t.hp));break;case"Bush":this.addChild(new H(t.x,t.y,t.hp));break;case"Stone":this.addChild(new E(t.x,t.y,t.hp));break}const T=new v(e(10),e(3));this.addChild(T),this.addChild(new L(224,64)),this.addChild(new d(e(4),e(5))),this.addChild(new d(e(5),e(5))),this.addChild(new d(e(6),e(5))),this.addChild(new n(e(4),e(4))),this.addChild(new n(e(6),e(4))),this.addChild(new n(e(8),e(3))),this.addChild(new n(e(9),e(3))),this.heroStartPosition=i.loadHero(this.levelId,w??this.defaultHeroPosition);const P=new C(this.heroStartPosition.x,this.heroStartPosition.y);this.addChild(P);let a=new c(e(4),e(3),[{string:"Du hast nun die st\xE4rkste Waffe und keine Ressource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Danke f\xFCr das Holz. Jetzt kannst du noch schneller Ressourcen sammeln!  Sprich mit meinem Bruder wenn du Zeit findest.",requires:["STORY_01_PART_01"]},{string:"Bringe mir 5x Holz und ich gebe dir einen Zauberstab der mehr Schaden austeilt!",storyFlag:"STORY_01_PART_01"}]);if(i.isInEquipment("rodPurple")&&p.add("STORY_01_PART_01"),i.isInEquipment("rodRed")&&p.add("STORY_02_PART_01"),!i.isInEquipment("rodPurple")){const t=new x(e(5),e(4),"rodPurple");this.addChild(t),a=new c(e(5),e(3),[{string:"Du hast nun die st\xE4rkste Waffe und keine Ressource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Danke f\xFCr das Holz. Jetzt kannst du noch schneller Ressourcen sammeln!  Sprich mit meinem Bruder wenn du Zeit findest.",requires:["STORY_01_PART_01"]},{string:"Bringe mir 5x Holz und ich gebe dir einen Zauberstab der mehr Schaden austeilt!",storyFlag:"STORY_01_PART_01"}])}this.addChild(a);const y={right:this.generateWall(new r(1568,32),new r(1568,832),o,"right"),left:this.generateWall(new r(16,32),new r(16,832),o,"left"),top:this.generateWall(new r(32,16),new r(1568,16),o,"top"),bottom:this.generateWall(new r(32,848),new r(1568,848),o,"bottom")};this.walls=new Set(Object.values(y).flat())}ready(){m.on(b,this,()=>{this.stopBackgroundSound(),m.emit(O,new I({position:new r(e(0),e(0)),heroPosition:new r(e(16),e(6))}))})}}
