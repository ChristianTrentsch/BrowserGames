"use strict";import{gridCells as e,TILE_SIZE as o}from"../helpers/grid.js";import{resources as w}from"../Resource.js";import{Vector2 as t}from"../Vector2.js";import{Sprite as x}from"../Sprite.js";import{Level as g}from"../objects/Level/Level.js";import{Exit as S}from"../objects/Exit/Exit.js";import{Hero as W}from"../objects/Hero/Hero.js";import{BUSH as k,Item as v,STONE as L,TREE as b}from"../objects/Item/Item.js";import{events as p,HERO_EXITS as R,CHANGE_LEVEL as C}from"../Events.js";import{CaveLevel1 as I}from"./CaveLevel1.js";import{SaveGame as d}from"../SaveGame.js";import{Tree as P}from"./parts/Tree/Tree.js";import{Stone as T}from"./parts/Stone/Stone.js";import{Square as l}from"./parts/Square/Square.js";import{Water as y}from"./parts/Water/Water.js";import{Bush as _}from"./parts/Bush/Bush.js";import{House as E}from"./parts/House/House.js";import{generateDefaultResources as G,generateDeko as B}from"../helpers/generateResources.js";import{Npc as O}from"../objects/Npc/Npc.js";import{Lamp as H}from"./parts/Lamp/Lamp.js";import{Deko as s}from"./parts/Deko/Deko.js";import{Animations as f}from"../Animations.js";import{FrameIndexPattern as u}from"../FrameIndexPattern.js";export class OutdoorLevel1 extends g{constructor(n){super(n,"./sounds/levels/background_music_02.mp3",.2);this.levelId="OutdoorLevel1";this.defaultHeroPosition=new t(e(60),e(21));this.initBackgroundSound(),this.background=new x({resource:w.images.outdoorSky,frameSize:new t(320,180),position:new t(0,0)});const i=new x({resource:w.images.outdoorGround,frameSize:new t(1600,800),position:new t(0,0)});this.addChild(i),this.checkGameProgress(),this.buildLevelGroupPurpleRod(),this.buildLevelGroupExit(),this.loadLevelResources(),this.loadLevelDeko(),this.loadStartSea(),this.addChild(new H(e(50),e(25))),this.addChild(new x({resource:w.images.animBushSmall,position:new t(e(48),e(25)),frame:0,hFrames:3,animations:new f({dekoIdle:new u({duration:5e3,frames:[{time:0,frame:0},{time:120,frame:1},{time:240,frame:0},{time:360,frame:2},{time:480,frame:0}]})})})),this.heroStartPosition=this.defaultHeroPosition;const a=d.loadHero();let r=0,m=0;a&&(this.heroStartPosition=a.pos??this.defaultHeroPosition,r=a.exp,m=a.level);const h=new W(this.heroStartPosition.x,this.heroStartPosition.y,r,m);this.addChild(h);const c={right:this.generateWall(new t(1568,32),new t(1568,764),o,"right"),left:this.generateWall(new t(16,32),new t(16,764),o,"left"),top:this.generateWall(new t(32,16),new t(1568,16),o,"top"),bottom:this.generateWall(new t(32,768),new t(1568,768),o,"bottom"),startIslandTop1:this.generateWall(new t(e(48),e(22)),new t(e(51),e(22)),o,"top"),startIslandTop2:this.generateWall(new t(e(52),e(23)),new t(e(57),e(23)),o,"top"),startIslandTop3:this.generateWall(new t(e(44),e(24)),new t(e(46),e(24)),o,"top"),startIslandTop4:this.generateWall(new t(e(44),e(26)),new t(e(46),e(26)),o,"top"),startIslandLeft1:this.generateWall(new t(e(47),e(23)),new t(e(47),e(24)),o,"left"),startIslandLeft2:this.generateWall(new t(e(47),e(26)),new t(e(47),e(26)),o,"left"),startIslandRight1:this.generateWall(new t(e(52),e(26)),new t(e(52),e(26)),o,"right"),startIslandBottom1:this.generateWall(new t(e(48),e(27)),new t(e(51),e(27)),o,"bottom"),startIslandBottom2:this.generateWall(new t(e(52),e(25)),new t(e(57),e(25)),o,"bottom"),startLakeTop1:this.generateWall(new t(e(43),e(19)),new t(e(58),e(19)),o,"top"),startLakeBottom1:this.generateWall(new t(e(43),e(29)),new t(e(58),e(29)),o,"bottom"),startLakeLeft1:this.generateWall(new t(e(43),e(20)),new t(e(43),e(24)),o,"left"),startLakeLeft2:this.generateWall(new t(e(43),e(26)),new t(e(43),e(28)),o,"left"),startLakeRight1:this.generateWall(new t(e(58),e(20)),new t(e(58),e(23)),o,"right"),startLakeRight2:this.generateWall(new t(e(58),e(25)),new t(e(58),e(28)),o,"right")};this.walls=new Set(Object.values(c).flat())}ready(){p.on(R,this,()=>{this.stopBackgroundSound();const n=new t(e(35),e(33)),i=d.loadHero();i&&(d.saveHero(i.level,n,i.exp),p.emit(C,new I(new t(0,0))))})}buildLevelGroupPurpleRod(){let n=new O(e(5),e(8),[{string:"Du hast nun die st\xE4rkste Waffe und keine Resource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Danke f\xFCr das Holz. Jetzt kannst du noch schneller Resourcen sammeln!  Sprich mit meinem Bruder wenn du Zeit findest.",requires:["STORY_01_PART_01"]},{string:"Bringe mir 5x Holz und ich gebe dir einen Zauberstab der mehr Schaden austeilt!",storyFlag:"STORY_01_PART_01"}]);d.isInEquipment("rodPurple")&&(n.position.x+=e(-1));const i=[n,new l(e(4),e(3)),new l(e(5),e(3)),new l(e(6),e(3)),new l(e(4),e(7)),new l(e(6),e(7)),new l(e(3),e(4)),new l(e(3),e(5)),new l(e(3),e(6)),new l(e(7),e(4)),new l(e(7),e(5)),new l(e(7),e(6))];if(!d.isInEquipment("rodPurple")){const a=new v(e(5),e(5),"rodPurple");i.push(a)}this.addChildrenGroup("lila Zauberstab",e(8),e(8),i,[{x1:4,x2:6,y1:0,y2:0},{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:0,x2:10,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}buildLevelGroupExit(){const n=[new S(e(3),e(3)),new E(e(7),e(6)),new y(e(3),e(6)),new y(e(4),e(6)),new y(e(5),e(6)),new y(e(6),e(6))];this.addChildrenGroup("Exit Gruppe",e(80),e(10),n,[{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:2,x2:8,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}loadLevelResources(){const n=G({levelId:"OutdoorLevel1",width:1600,height:800,seed:3,pathZones:[...this.noResourceZones,{x1:41,x2:48,y1:17,y2:17},{x1:41,x2:60,y1:18,y2:19},{x1:40,x2:61,y1:20,y2:28},{x1:41,x2:58,y1:29,y2:29},{x1:41,x2:53,y1:30,y2:30},{x1:42,x2:49,y1:31,y2:31},{x1:68,x2:80,y1:24,y2:25},{x1:25,x2:37,y1:23,y2:25},{x1:25,x2:26,y1:26,y2:39},{x1:8,x2:24,y1:40,y2:41},{x1:8,x2:9,y1:22,y2:39},{x1:10,x2:14,y1:22,y2:23}],density:{Tree:.5,Bush:.2,Stone:.1},border:32}),i=d.loadResources(this.levelId),a=n.map(r=>{const m=i.find(h=>h.x===r.x&&h.y===r.y&&h.type===r.type);return m?{...r,...m}:r});for(const r of a)if(r.hp>0)switch(r.type){case k:this.addChild(new _(r.x,r.y,r.hp));break;case b:this.addChild(new P(r.x,r.y,r.hp));break;case L:this.addChild(new T(r.x,r.y,r.hp));break}}loadLevelDeko(){const n=B({levelId:"OutdoorLevel1",width:1600,height:800,seed:2,pathZones:[...this.noResourceZones,{x1:41,x2:48,y1:17,y2:17},{x1:41,x2:60,y1:18,y2:19},{x1:40,x2:61,y1:20,y2:28},{x1:41,x2:58,y1:29,y2:29},{x1:41,x2:53,y1:30,y2:30},{x1:42,x2:49,y1:31,y2:31},{x1:68,x2:80,y1:24,y2:25},{x1:25,x2:37,y1:23,y2:25},{x1:25,x2:26,y1:26,y2:39},{x1:8,x2:24,y1:40,y2:41},{x1:8,x2:9,y1:22,y2:39},{x1:10,x2:14,y1:22,y2:23}],density:{animBushSmall:.02,animBush:.01},border:32});for(const i of n){let a=this.getRandomDelay();switch(i.type){case"animBushSmall":this.addChild(new x({resource:w.images[i.type],position:new t(i.x,i.y),frame:0,hFrames:3,animations:new f({dekoIdle:new u({duration:a,frames:[{time:0,frame:0},{time:120,frame:1},{time:240,frame:0},{time:360,frame:2},{time:480,frame:0}]})})}));break;case"animBush":this.addChild(new x({resource:w.images[i.type],position:new t(i.x,i.y),frame:0,hFrames:6,animations:new f({dekoIdle:new u({duration:a,frames:[{time:0,frame:0},{time:120,frame:1},{time:240,frame:2},{time:360,frame:1},{time:480,frame:0},{time:600,frame:3},{time:720,frame:4},{time:840,frame:3},{time:960,frame:0}]})})}));break}}}getRandomDelay(n=4,i=7){const a=n*1e3,r=i*1e3;return Math.random()*(r-a)+a}loadStartSea(){for(let n=43;n<59;n++)this.addChild(new s(new t(e(n),e(19)),"animWater",0,8,1,new t(16,16)));for(let n=43;n<59;n++)this.addChild(new s(new t(e(n),e(20)),"animWater",0,8,1,new t(16,16)));for(let n=43;n<59;n++)this.addChild(new s(new t(e(n),e(21)),"animWater",0,8,1,new t(16,16)));for(let n=43;n<59;n++)this.addChild(new s(new t(e(n),e(22)),"animWater",0,8,1,new t(16,16)));for(let n=43;n<48;n++)this.addChild(new s(new t(e(n),e(23)),"animWater",0,8,1,new t(16,16)));for(let n=52;n<59;n++)this.addChild(new s(new t(e(n),e(23)),"animWater",0,8,1,new t(16,16)));for(let n=43;n<48;n++)this.addChild(new s(new t(e(n),e(24)),"animWater",0,8,1,new t(16,16)));for(let n=52;n<59;n++)this.addChild(new s(new t(e(n),e(25)),"animWater",0,8,1,new t(16,16)));for(let n=43;n<48;n++)this.addChild(new s(new t(e(n),e(26)),"animWater",0,8,1,new t(16,16)));for(let n=52;n<59;n++)this.addChild(new s(new t(e(n),e(26)),"animWater",0,8,1,new t(16,16)));for(let n=43;n<59;n++)this.addChild(new s(new t(e(n),e(27)),"animWater",0,8,1,new t(16,16)));for(let n=43;n<59;n++)this.addChild(new s(new t(e(n),e(28)),"animWater",0,8,1,new t(16,16)));for(let n=43;n<59;n++)this.addChild(new s(new t(e(n),e(29)),"animWater",0,8,1,new t(16,16)))}}
