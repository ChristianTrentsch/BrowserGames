"use strict";import{gridCells as e,TILE_SIZE as u}from"../helpers/grid.js";import{resources as p}from"../Resource.js";import{Vector2 as t}from"../Vector2.js";import{Sprite as m}from"../Sprite.js";import{Level as w}from"../objects/Level/Level.js";import{Exit as f}from"../objects/Exit/Exit.js";import{Hero as S}from"../objects/Hero/Hero.js";import{BUSH as v,Item as g,STONE as b,TREE as P}from"../objects/Item/Item.js";import{events as x,HERO_EXITS as R,CHANGE_LEVEL as _}from"../Events.js";import{CaveLevel1 as E}from"./CaveLevel1.js";import{SaveGame as l}from"../SaveGame.js";import{Tree as G}from"./parts/Tree/Tree.js";import{Stone as L}from"./parts/Stone/Stone.js";import{Square as r}from"./parts/Square/Square.js";import{Water as h}from"./parts/Water/Water.js";import{Bush as k}from"./parts/Bush/Bush.js";import{House as T}from"./parts/House/House.js";import{generateDefaultResources as H}from"../helpers/generateResources.js";import{Npc as O}from"../objects/Npc/Npc.js";export class OutdoorLevel1 extends w{constructor({position:i,heroPosition:n}){super(i,"./sounds/levels/background_music_02.mp3",.2);this.levelId="OutdoorLevel1";this.defaultHeroPosition=new t(e(60),e(21));this.initBackgroundSound(),this.background=new m({resource:p.images.outdoorSky,frameSize:new t(320,180),position:new t(0,0)});const a=new m({resource:p.images.outdoorGround,frameSize:new t(1600,800),position:new t(0,0)});this.addChild(a),this.checkGameProgress(),this.buildLevelGroupPurpleRod(),this.buildLevelGroupExit(),this.loadLevelResources(),this.heroStartPosition=this.defaultHeroPosition;const o=l.loadHero();let d=0,s=0;o&&(this.heroStartPosition=o.pos??this.defaultHeroPosition,d=o.exp,s=o.level);const y=new S(this.heroStartPosition.x,this.heroStartPosition.y,d,s);this.addChild(y);const c={right:this.generateWall(new t(1568,32),new t(1568,764),u,"right"),left:this.generateWall(new t(16,32),new t(16,764),u,"left"),top:this.generateWall(new t(32,16),new t(1568,16),u,"top"),bottom:this.generateWall(new t(32,768),new t(1568,768),u,"bottom")};this.walls=new Set(Object.values(c).flat())}ready(){x.on(R,this,()=>{this.stopBackgroundSound();const i=new t(e(35),e(33)),n=l.loadHero();n&&(l.saveHero(n.level,i,n.exp),x.emit(_,new E({position:new t(e(0),e(0))})))})}buildLevelGroupPurpleRod(){let i=new O(e(5),e(8),[{string:"Du hast nun die st\xE4rkste Waffe und keine Resource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Danke f\xFCr das Holz. Jetzt kannst du noch schneller Resourcen sammeln!  Sprich mit meinem Bruder wenn du Zeit findest.",requires:["STORY_01_PART_01"]},{string:"Bringe mir 5x Holz und ich gebe dir einen Zauberstab der mehr Schaden austeilt!",storyFlag:"STORY_01_PART_01"}]);l.isInEquipment("rodPurple")&&(i.position.x+=e(-1));const n=[i,new r(e(4),e(3)),new r(e(5),e(3)),new r(e(6),e(3)),new r(e(4),e(7)),new r(e(6),e(7)),new r(e(3),e(4)),new r(e(3),e(5)),new r(e(3),e(6)),new r(e(7),e(4)),new r(e(7),e(5)),new r(e(7),e(6))];if(!l.isInEquipment("rodPurple")){const a=new g(e(5),e(5),"rodPurple");n.push(a)}this.addChildrenGroup("lila Zauberstab",e(34),e(6),n,[{x1:4,x2:6,y1:0,y2:0},{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:0,x2:10,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}buildLevelGroupExit(){const i=[new f(e(3),e(3)),new T(e(7),e(6)),new h(e(3),e(6)),new h(e(4),e(6)),new h(e(5),e(6)),new h(e(6),e(6))];this.addChildrenGroup("Exit Gruppe",e(7),e(6),i,[{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:2,x2:8,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}loadLevelResources(){const i=H({levelId:"OutdoorLevel1",width:1600,height:800,seed:3,pathZones:[...this.noResourceZones,{x1:58,x2:62,y1:19,y2:19},{x1:57,x2:63,y1:20,y2:20},{x1:56,x2:64,y1:21,y2:21},{x1:57,x2:63,y1:22,y2:22},{x1:58,x2:62,y1:23,y2:23},{x1:11,x2:55,y1:20,y2:22}],density:{Tree:.5,Bush:.2,Stone:.1},border:32}),n=l.loadResources(this.levelId),a=i.map(o=>{const d=n.find(s=>s.x===o.x&&s.y===o.y&&s.type===o.type);return d?{...o,...d}:o});for(const o of a)if(o.hp>0)switch(o.type){case v:this.addChild(new k(o.x,o.y,o.hp));break;case P:this.addChild(new G(o.x,o.y,o.hp));break;case b:this.addChild(new L(o.x,o.y,o.hp));break}}}
