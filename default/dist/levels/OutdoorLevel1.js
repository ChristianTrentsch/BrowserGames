"use strict";import{gridCells as e,TILE_SIZE as d}from"../helpers/grid.js";import{resources as o}from"../Resource.js";import{Vector2 as n}from"../Vector2.js";import{Sprite as W}from"../Sprite.js";import{Level as f}from"../objects/Level/Level.js";import{Exit as c}from"../objects/Exit/Exit.js";import{Hero as g}from"../objects/Hero/Hero.js";import{BUSH as S,Item as k,STONE as v,TREE as L}from"../objects/Item/Item.js";import{events as u,HERO_EXITS as b,CHANGE_LEVEL as R}from"../Events.js";import{CaveLevel1 as I}from"./CaveLevel1.js";import{SaveGame as s}from"../SaveGame.js";import{Tree as P}from"./parts/Tree/Tree.js";import{Stone as T}from"./parts/Stone/Stone.js";import{Square as h}from"./parts/Square/Square.js";import{Water as C}from"./parts/Water/Water.js";import{Bush as _}from"./parts/Bush/Bush.js";import{House as E}from"./parts/House/House.js";import{generateDefaultResources as G,generateDeko as B}from"../helpers/generateResources.js";import{Npc as O}from"../objects/Npc/Npc.js";import{Lamp as H}from"./parts/Lamp/Lamp.js";import{Deko as i}from"./parts/Deko/Deko.js";import{Animations as y}from"../Animations.js";import{FrameIndexPattern as x}from"../FrameIndexPattern.js";export class OutdoorLevel1 extends f{constructor(w){super(w,"./sounds/levels/background_music_02.mp3",.2);this.levelId="OutdoorLevel1";this.defaultHeroPosition=new n(e(60),e(21));this.initBackgroundSound(),this.background=new W({resource:o.images.outdoorSky,frameSize:new n(320,180),position:new n(0,0)});const t=new W({resource:o.images.outdoorGround,frameSize:new n(1600,800),position:new n(0,0)});this.addChild(t),this.checkGameProgress(),this.buildLevelGroupPurpleRod(),this.buildLevelGroupExit(),this.loadLevelResources(),this.loadLevelDeko(),this.loadStartSea(),this.addChild(new H(e(50),e(25))),this.addChild(new W({resource:o.images.animBushSmall,position:new n(e(48),e(25)),frame:0,hFrames:3,animations:new y({dekoIdle:new x({duration:5e3,frames:[{time:0,frame:0},{time:120,frame:1},{time:240,frame:0},{time:360,frame:2},{time:480,frame:0}]})})})),this.heroStartPosition=this.defaultHeroPosition;const r=s.loadHero();let a=0,l=0;r&&(this.heroStartPosition=r.pos??this.defaultHeroPosition,a=r.exp,l=r.level);const m=new g(this.heroStartPosition.x,this.heroStartPosition.y,a,l);this.addChild(m);const p={right:this.generateWall(new n(1568,32),new n(1568,764),d,"right"),left:this.generateWall(new n(16,32),new n(16,764),d,"left"),top:this.generateWall(new n(32,16),new n(1568,16),d,"top"),bottom:this.generateWall(new n(32,768),new n(1568,768),d,"bottom"),startIslandTop1:this.generateWall(new n(e(48),e(22)),new n(e(51),e(22)),d,"top"),startIslandTop2:this.generateWall(new n(e(52),e(23)),new n(e(57),e(23)),d,"top"),startIslandTop3:this.generateWall(new n(e(44),e(24)),new n(e(46),e(24)),d,"top"),startIslandTop4:this.generateWall(new n(e(44),e(26)),new n(e(46),e(26)),d,"top"),startIslandLeft1:this.generateWall(new n(e(47),e(23)),new n(e(47),e(24)),d,"left"),startIslandLeft2:this.generateWall(new n(e(47),e(26)),new n(e(47),e(26)),d,"left"),startIslandRight1:this.generateWall(new n(e(52),e(26)),new n(e(52),e(26)),d,"right"),startIslandBottom1:this.generateWall(new n(e(48),e(27)),new n(e(51),e(27)),d,"bottom"),startIslandBottom2:this.generateWall(new n(e(52),e(25)),new n(e(57),e(25)),d,"bottom"),startLakeTop1:this.generateWall(new n(e(43),e(19)),new n(e(58),e(19)),d,"top"),startLakeBottom1:this.generateWall(new n(e(43),e(29)),new n(e(58),e(29)),d,"bottom"),startLakeLeft1:this.generateWall(new n(e(43),e(20)),new n(e(43),e(24)),d,"left"),startLakeLeft2:this.generateWall(new n(e(43),e(26)),new n(e(43),e(28)),d,"left"),startLakeRight1:this.generateWall(new n(e(58),e(20)),new n(e(58),e(23)),d,"right"),startLakeRight2:this.generateWall(new n(e(58),e(25)),new n(e(58),e(28)),d,"right")};this.walls=new Set(Object.values(p).flat())}ready(){u.on(b,this,()=>{this.stopBackgroundSound();const w=new n(e(35),e(33)),t=s.loadHero();t&&(s.saveHero(t.level,w,t.exp),u.emit(R,new I(new n(0,0))))})}buildLevelGroupPurpleRod(){let w=new O(e(5),e(8),[{string:"Du hast nun die st\xE4rkste Waffe und keine Resource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Danke f\xFCr das Holz. Jetzt kannst du noch schneller Resourcen sammeln!  Sprich mit meinem Bruder wenn du Zeit findest.",requires:["STORY_01_PART_01"]},{string:"Bringe mir 5x Holz und ich gebe dir einen Zauberstab der mehr Schaden austeilt!",storyFlag:"STORY_01_PART_01"}]);s.isInEquipment("rodPurple")&&(w.position.x+=e(-1));const t=[w,new h(e(4),e(3)),new h(e(5),e(3)),new h(e(6),e(3)),new h(e(4),e(7)),new h(e(6),e(7)),new h(e(3),e(4)),new h(e(3),e(5)),new h(e(3),e(6)),new h(e(7),e(4)),new h(e(7),e(5)),new h(e(7),e(6))];if(!s.isInEquipment("rodPurple")){const r=new k(e(5),e(5),"rodPurple");t.push(r)}this.addChildrenGroup("lila Zauberstab",e(8),e(8),t,[{x1:4,x2:6,y1:0,y2:0},{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:0,x2:10,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}buildLevelGroupExit(){const w=[new c(e(3),e(3)),new E(e(7),e(6)),new C(e(3),e(6)),new C(e(4),e(6)),new C(e(5),e(6)),new C(e(6),e(6))];this.addChildrenGroup("Exit Gruppe",e(80),e(10),w,[{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:2,x2:8,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}loadLevelResources(){const w=G({levelId:"OutdoorLevel1",width:1600,height:800,seed:3,pathZones:[...this.noResourceZones,{x1:41,x2:48,y1:17,y2:17},{x1:41,x2:60,y1:18,y2:19},{x1:40,x2:61,y1:20,y2:28},{x1:41,x2:58,y1:29,y2:29},{x1:41,x2:53,y1:30,y2:30},{x1:42,x2:49,y1:31,y2:31},{x1:68,x2:80,y1:24,y2:25},{x1:25,x2:37,y1:23,y2:25},{x1:25,x2:26,y1:26,y2:39},{x1:8,x2:24,y1:40,y2:41},{x1:8,x2:9,y1:22,y2:39},{x1:10,x2:14,y1:22,y2:23}],density:{Tree:.5,Bush:.2,Stone:.1},border:32}),t=s.loadResources(this.levelId),r=w.map(a=>{const l=t.find(m=>m.x===a.x&&m.y===a.y&&m.type===a.type);return l?{...a,...l}:a});for(const a of r)if(a.hp>0)switch(a.type){case S:this.addChild(new _(a.x,a.y,a.hp));break;case L:this.addChild(new P(a.x,a.y,a.hp));break;case v:this.addChild(new T(a.x,a.y,a.hp));break}}loadLevelDeko(){const w=B({levelId:"OutdoorLevel1",width:1600,height:800,seed:2,pathZones:[...this.noResourceZones,{x1:41,x2:48,y1:17,y2:17},{x1:41,x2:60,y1:18,y2:19},{x1:40,x2:61,y1:20,y2:28},{x1:41,x2:58,y1:29,y2:29},{x1:41,x2:53,y1:30,y2:30},{x1:42,x2:49,y1:31,y2:31},{x1:68,x2:80,y1:24,y2:25},{x1:25,x2:37,y1:23,y2:25},{x1:25,x2:26,y1:26,y2:39},{x1:8,x2:24,y1:40,y2:41},{x1:8,x2:9,y1:22,y2:39},{x1:10,x2:14,y1:22,y2:23}],density:{animBushSmall:.02,animBush:.01},border:32});for(const t of w){let r=this.getRandomDelay();switch(t.type){case"animBushSmall":this.addChild(new W({resource:o.images[t.type],position:new n(t.x,t.y),frame:0,hFrames:3,animations:new y({dekoIdle:new x({duration:r,frames:[{time:0,frame:0},{time:120,frame:1},{time:240,frame:0},{time:360,frame:2},{time:480,frame:0}]})})}));break;case"animBush":this.addChild(new W({resource:o.images[t.type],position:new n(t.x,t.y),frame:0,hFrames:6,animations:new y({dekoIdle:new x({duration:r,frames:[{time:0,frame:0},{time:120,frame:1},{time:240,frame:2},{time:360,frame:1},{time:480,frame:0},{time:600,frame:3},{time:720,frame:4},{time:840,frame:3},{time:960,frame:0}]})})}));break}}}getRandomDelay(w=4,t=7){const r=w*1e3,a=t*1e3;return Math.random()*(a-r)+r}loadStartSea(){this.addChild(new i(new n(e(43),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(44),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(45),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(46),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(47),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(48),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(49),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(50),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(51),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(52),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(53),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(54),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(55),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(56),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(57),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(58),e(19)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(43),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(44),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(45),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(46),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(47),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(48),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(49),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(50),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(51),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(52),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(53),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(54),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(55),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(56),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(57),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(58),e(20)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(43),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(44),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(45),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(46),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(47),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(48),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(49),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(50),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(51),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(52),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(53),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(54),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(55),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(56),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(57),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(58),e(21)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(43),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(44),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(45),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(46),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(47),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(48),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(49),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(50),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(51),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(52),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(53),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(54),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(55),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(56),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(57),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(58),e(22)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(43),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(44),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(45),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(46),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(47),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(52),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(53),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(54),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(55),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(56),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(57),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(58),e(23)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(43),e(24)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(44),e(24)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(45),e(24)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(46),e(24)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(47),e(24)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(52),e(25)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(53),e(25)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(54),e(25)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(55),e(25)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(56),e(25)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(57),e(25)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(58),e(25)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(43),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(44),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(45),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(46),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(47),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(52),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(53),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(54),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(55),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(56),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(57),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(58),e(26)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(43),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(44),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(45),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(46),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(47),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(48),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(49),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(50),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(51),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(52),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(53),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(54),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(55),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(56),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(57),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(58),e(27)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(43),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(44),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(45),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(46),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(47),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(48),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(49),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(50),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(51),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(52),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(53),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(54),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(55),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(56),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(57),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(58),e(28)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(43),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(44),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(45),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(46),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(47),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(48),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(49),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(50),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(51),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(52),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(53),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(54),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(55),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(56),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(57),e(29)),"animWater",0,8,1,new n(16,16))),this.addChild(new i(new n(e(58),e(29)),"animWater",0,8,1,new n(16,16)))}}
