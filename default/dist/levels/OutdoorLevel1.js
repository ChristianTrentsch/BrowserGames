"use strict";import{gridCells as e,TILE_SIZE as o}from"../helpers/grid.js";import{resources as m}from"../Resource.js";import{Vector2 as t}from"../Vector2.js";import{Sprite as p}from"../Sprite.js";import{Level as y}from"../objects/Level/Level.js";import{Exit as c}from"../objects/Exit/Exit.js";import{Hero as g}from"../objects/Hero/Hero.js";import{BUSH as f,Item as L,STONE as S,TREE as b}from"../objects/Item/Item.js";import{events as u,HERO_EXITS as k,CHANGE_LEVEL as W}from"../Events.js";import{CaveLevel1 as v}from"./CaveLevel1.js";import{SaveGame as l}from"../SaveGame.js";import{Tree as R}from"./parts/Tree/Tree.js";import{Stone as T}from"./parts/Stone/Stone.js";import{Square as n}from"./parts/Square/Square.js";import{Water as d}from"./parts/Water/Water.js";import{Bush as I}from"./parts/Bush/Bush.js";import{House as P}from"./parts/House/House.js";import{generateDefaultResources as _}from"../helpers/generateResources.js";import{Npc as E}from"../objects/Npc/Npc.js";import{Lamp as G}from"./parts/Lamp/Lamp.js";export class OutdoorLevel1 extends y{constructor(s){super(s,"./sounds/levels/background_music_02.mp3",.2);this.levelId="OutdoorLevel1";this.defaultHeroPosition=new t(e(60),e(21));this.initBackgroundSound(),this.background=new p({resource:m.images.outdoorSky,frameSize:new t(320,180),position:new t(0,0)});const a=new p({resource:m.images.outdoorGround,frameSize:new t(1600,800),position:new t(0,0)});this.addChild(a),this.checkGameProgress(),this.buildLevelGroupPurpleRod(),this.buildLevelGroupExit(),this.loadLevelResources(),this.addChild(new G(e(50),e(25))),this.heroStartPosition=this.defaultHeroPosition;const i=l.loadHero();let r=0,h=0;i&&(this.heroStartPosition=i.pos??this.defaultHeroPosition,r=i.exp,h=i.level);const w=new g(this.heroStartPosition.x,this.heroStartPosition.y,r,h);this.addChild(w);const x={right:this.generateWall(new t(1568,32),new t(1568,764),o,"right"),left:this.generateWall(new t(16,32),new t(16,764),o,"left"),top:this.generateWall(new t(32,16),new t(1568,16),o,"top"),bottom:this.generateWall(new t(32,768),new t(1568,768),o,"bottom"),startIslandTop1:this.generateWall(new t(e(48),e(22)),new t(e(51),e(22)),o,"top"),startIslandTop2:this.generateWall(new t(e(52),e(23)),new t(e(57),e(23)),o,"top"),startIslandTop3:this.generateWall(new t(e(44),e(24)),new t(e(46),e(24)),o,"top"),startIslandTop4:this.generateWall(new t(e(44),e(26)),new t(e(46),e(26)),o,"top"),startIslandLeft1:this.generateWall(new t(e(47),e(23)),new t(e(47),e(24)),o,"left"),startIslandLeft2:this.generateWall(new t(e(47),e(26)),new t(e(47),e(26)),o,"left"),startIslandRight1:this.generateWall(new t(e(52),e(26)),new t(e(52),e(26)),o,"right"),startIslandBottom1:this.generateWall(new t(e(48),e(27)),new t(e(51),e(27)),o,"bottom"),startIslandBottom2:this.generateWall(new t(e(52),e(25)),new t(e(57),e(25)),o,"bottom"),startLakeTop1:this.generateWall(new t(e(43),e(19)),new t(e(46),e(19)),o,"top"),startLakeTop2:this.generateWall(new t(e(47),e(20)),new t(e(53),e(20)),o,"top"),startLakeTop3:this.generateWall(new t(e(54),e(21)),new t(e(56),e(21)),o,"top"),startLakeLeft1:this.generateWall(new t(e(43),e(24)),new t(e(43),e(24)),o,"left"),startLakeLeft2:this.generateWall(new t(e(43),e(26)),new t(e(43),e(28)),o,"left"),startLakeLeft3:this.generateWall(new t(e(43),e(20)),new t(e(43),e(21)),o,"left"),startLakeLeft4:this.generateWall(new t(e(44),e(22)),new t(e(44),e(23)),o,"left"),startLakeRight1:this.generateWall(new t(e(57),e(20)),new t(e(57),e(20)),o,"right"),startLakeRight2:this.generateWall(new t(e(58),e(20)),new t(e(58),e(22)),o,"right"),startLakeBottom1:this.generateWall(new t(e(56),e(26)),new t(e(58),e(26)),o,"bottom"),startLakeBottom2:this.generateWall(new t(e(53),e(27)),new t(e(55),e(27)),o,"bottom"),startLakeBottom3:this.generateWall(new t(e(44),e(28)),new t(e(52),e(28)),o,"bottom"),startLakeBottom4:this.generateWall(new t(e(44),e(29)),new t(e(44),e(29)),o,"bottom"),startLakeBottom5:this.generateWall(new t(e(47),e(29)),new t(e(48),e(29)),o,"bottom")};this.walls=new Set(Object.values(x).flat())}ready(){u.on(k,this,()=>{this.stopBackgroundSound();const s=new t(e(35),e(33)),a=l.loadHero();a&&(l.saveHero(a.level,s,a.exp),u.emit(W,new v(new t(0,0))))})}buildLevelGroupPurpleRod(){let s=new E(e(5),e(8),[{string:"Du hast nun die st\xE4rkste Waffe und keine Resource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Danke f\xFCr das Holz. Jetzt kannst du noch schneller Resourcen sammeln!  Sprich mit meinem Bruder wenn du Zeit findest.",requires:["STORY_01_PART_01"]},{string:"Bringe mir 5x Holz und ich gebe dir einen Zauberstab der mehr Schaden austeilt!",storyFlag:"STORY_01_PART_01"}]);l.isInEquipment("rodPurple")&&(s.position.x+=e(-1));const a=[s,new n(e(4),e(3)),new n(e(5),e(3)),new n(e(6),e(3)),new n(e(4),e(7)),new n(e(6),e(7)),new n(e(3),e(4)),new n(e(3),e(5)),new n(e(3),e(6)),new n(e(7),e(4)),new n(e(7),e(5)),new n(e(7),e(6))];if(!l.isInEquipment("rodPurple")){const i=new L(e(5),e(5),"rodPurple");a.push(i)}this.addChildrenGroup("lila Zauberstab",e(8),e(8),a,[{x1:4,x2:6,y1:0,y2:0},{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:0,x2:10,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}buildLevelGroupExit(){const s=[new c(e(3),e(3)),new P(e(7),e(6)),new d(e(3),e(6)),new d(e(4),e(6)),new d(e(5),e(6)),new d(e(6),e(6))];this.addChildrenGroup("Exit Gruppe",e(80),e(10),s,[{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:2,x2:8,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}loadLevelResources(){const s=_({levelId:"OutdoorLevel1",width:1600,height:800,seed:3,pathZones:[...this.noResourceZones,{x1:41,x2:48,y1:17,y2:17},{x1:41,x2:60,y1:18,y2:19},{x1:40,x2:61,y1:20,y2:28},{x1:41,x2:58,y1:29,y2:29},{x1:41,x2:53,y1:30,y2:30},{x1:42,x2:49,y1:31,y2:31},{x1:68,x2:80,y1:24,y2:25},{x1:25,x2:37,y1:23,y2:25},{x1:25,x2:26,y1:26,y2:39},{x1:8,x2:24,y1:40,y2:41},{x1:8,x2:9,y1:22,y2:39},{x1:10,x2:14,y1:22,y2:23}],density:{Tree:.5,Bush:.2,Stone:.1},border:32}),a=l.loadResources(this.levelId),i=s.map(r=>{const h=a.find(w=>w.x===r.x&&w.y===r.y&&w.type===r.type);return h?{...r,...h}:r});for(const r of i)if(r.hp>0)switch(r.type){case f:this.addChild(new I(r.x,r.y,r.hp));break;case b:this.addChild(new R(r.x,r.y,r.hp));break;case S:this.addChild(new T(r.x,r.y,r.hp));break}}}
