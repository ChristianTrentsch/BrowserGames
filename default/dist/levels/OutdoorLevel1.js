"use strict";import{gridCells as e,TILE_SIZE as l}from"../helpers/grid.js";import{resources as h}from"../Resource.js";import{Vector2 as t}from"../Vector2.js";import{Sprite as p}from"../Sprite.js";import{Level as y}from"../objects/Level/Level.js";import{Exit as c}from"../objects/Exit/Exit.js";import{Hero as w}from"../objects/Hero/Hero.js";import{Item as f}from"../objects/Item/Item.js";import{events as x,HERO_EXITS as g,CHANGE_LEVEL as S}from"../Events.js";import{CaveLevel1 as v}from"./CaveLevel1.js";import{SaveGame as d}from"../SaveGame.js";import{Tree as b}from"./parts/Tree/Tree.js";import{Stone as R}from"./parts/Stone/Stone.js";import{Square as r}from"./parts/Square/Square.js";import{Water as u}from"./parts/Water/Water.js";import{Bush as P}from"./parts/Bush/Bush.js";import{House as _}from"./parts/House/House.js";import{generateDefaultResources as G}from"../helpers/generateResources.js";import{Npc as L}from"../objects/Npc/Npc.js";export class OutdoorLevel1 extends y{constructor({position:i,heroPosition:n}){super(i,"./sounds/levels/background_music_02.mp3",.2);this.defaultHeroPosition=new t(e(60),e(21));this.levelId="OutdoorLevel1";this.initBackgroundSound(),this.background=new p({resource:h.images.outdoorSky,frameSize:new t(320,180),position:new t(0,0)});const s=new p({resource:h.images.outdoorGround,frameSize:new t(1600,900),position:new t(0,0)});this.addChild(s),this.checkGameProgress(),this.buildLevelGroupPurpleRod(),this.buildLevelGroupExit(),this.loadLevelResources(),this.heroStartPosition=d.loadHero(this.levelId,n??this.defaultHeroPosition);const o=new w(this.heroStartPosition.x,this.heroStartPosition.y);this.addChild(o);const a={right:this.generateWall(new t(1568,32),new t(1568,864),l,"right"),left:this.generateWall(new t(16,32),new t(16,864),l,"left"),top:this.generateWall(new t(32,16),new t(1568,16),l,"top"),bottom:this.generateWall(new t(32,864),new t(1568,864),l,"bottom")};this.walls=new Set(Object.values(a).flat())}ready(){x.on(g,this,()=>{this.stopBackgroundSound(),x.emit(S,new v({position:new t(e(0),e(0)),heroPosition:new t(e(16),e(6))}))})}buildLevelGroupPurpleRod(){let i=new L(e(5),e(8),[{string:"Du hast nun die st\xE4rkste Waffe und keine Resource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Danke f\xFCr das Holz. Jetzt kannst du noch schneller Resourcen sammeln!  Sprich mit meinem Bruder wenn du Zeit findest.",requires:["STORY_01_PART_01"]},{string:"Bringe mir 5x Holz und ich gebe dir einen Zauberstab der mehr Schaden austeilt!",storyFlag:"STORY_01_PART_01"}]);d.isInEquipment("rodPurple")&&(i.position.x+=e(-1));const n=[i,new r(e(4),e(3)),new r(e(5),e(3)),new r(e(6),e(3)),new r(e(4),e(7)),new r(e(6),e(7)),new r(e(3),e(4)),new r(e(3),e(5)),new r(e(3),e(6)),new r(e(7),e(4)),new r(e(7),e(5)),new r(e(7),e(6))];if(!d.isInEquipment("rodPurple")){const s=new f(e(5),e(5),"rodPurple");n.push(s)}this.addChildrenGroup("lila Zauberstab",e(34),e(6),n,[{x1:4,x2:6,y1:0,y2:0},{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:0,x2:10,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}buildLevelGroupExit(){const i=[new c(e(3),e(3)),new _(e(7),e(6)),new u(e(3),e(6)),new u(e(4),e(6)),new u(e(5),e(6)),new u(e(6),e(6))];this.addChildrenGroup("Exit Gruppe",e(7),e(6),i,[{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:2,x2:8,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}loadLevelResources(){const i=G({levelId:"OutdoorLevel1",width:1600,height:900,seed:3,pathZones:[...this.noResourceZones,{x1:58,x2:62,y1:19,y2:19},{x1:57,x2:63,y1:20,y2:20},{x1:56,x2:64,y1:21,y2:21},{x1:57,x2:63,y1:22,y2:22},{x1:58,x2:62,y1:23,y2:23},{x1:11,x2:55,y1:20,y2:22}],density:{Tree:.5,Bush:.2,Stone:.1},border:32}),n=d.loadResources(this.levelId),s=i.map(o=>{const a=n.find(m=>m.x===o.x&&m.y===o.y&&m.type===o.type);return a?{...o,...a}:o});for(const o of s)if(o.hp>0)switch(o.type){case"tree":this.addChild(new b(o.x,o.y,o.hp));break;case"bush":this.addChild(new P(o.x,o.y,o.hp));break;case"stone":this.addChild(new R(o.x,o.y,o.hp));break}}}
