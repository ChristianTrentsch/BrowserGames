"use strict";import{gridCells as e,TILE_SIZE as r}from"../helpers/grid.js";import{resources as y}from"../Resource.js";import{Vector2 as t}from"../Vector2.js";import{Sprite as c}from"../Sprite.js";import{Level as f}from"../objects/Level/Level.js";import{Exit as p}from"../objects/Exit/Exit.js";import{Hero as g}from"../objects/Hero/Hero.js";import{BUSH as S,Item as v,STONE as L,TREE as k}from"../objects/Item/Item.js";import{events as m,HERO_EXITS as R,CHANGE_LEVEL as b}from"../Events.js";import{CaveLevel1 as W}from"./CaveLevel1.js";import{SaveGame as l}from"../SaveGame.js";import{Tree as I}from"./parts/Tree/Tree.js";import{Stone as P}from"./parts/Stone/Stone.js";import{Square as a}from"./parts/Square/Square.js";import{Water as h}from"./parts/Water/Water.js";import{Bush as T}from"./parts/Bush/Bush.js";import{House as _}from"./parts/House/House.js";import{generateDefaultResources as E,generateDeko as G}from"../helpers/generateResources.js";import{Npc as C}from"../objects/Npc/Npc.js";import{Deko as x}from"../objects/Animations/Deko.js";export class OutdoorLevel1 extends f{constructor(o){super(o,"./sounds/levels/background_music_02.mp3",.2);this.levelId="OutdoorLevel1";this.defaultHeroPosition=new t(e(60),e(21));this.initBackgroundSound(),this.background=new c({resource:y.images.outdoorSky,frameSize:new t(320,180),position:new t(0,0)});const n=new c({resource:y.images.outdoorGround,frameSize:new t(1600,800),position:new t(0,0)});this.addChild(n),this.checkGameProgress(),this.buildLevelGroupPurpleRod(),this.buildLevelGroupExit(),this.loadLevelResources(),this.loadLevelDeko(),this.loadStartLake(),this.addChild(new x(new t(e(50),e(25)),"animTorch")),this.addChild(new x(new t(e(48),e(25)),"animBushSmall",7e3)),this.heroStartPosition=this.defaultHeroPosition;const s=l.loadHero();let i=0,d=0;s&&(this.heroStartPosition=s.pos??this.defaultHeroPosition,i=s.exp,d=s.level);const u=new g(this.heroStartPosition.x,this.heroStartPosition.y,i,d);this.addChild(u);const w={right:this.generateWall(new t(1568,32),new t(1568,764),r,"right"),left:this.generateWall(new t(16,32),new t(16,764),r,"left"),top:this.generateWall(new t(32,16),new t(1568,16),r,"top"),bottom:this.generateWall(new t(32,768),new t(1568,768),r,"bottom"),startIslandTop1:this.generateWall(new t(e(48),e(22)),new t(e(51),e(22)),r,"top"),startIslandTop2:this.generateWall(new t(e(52),e(23)),new t(e(57),e(23)),r,"top"),startIslandTop3:this.generateWall(new t(e(44),e(24)),new t(e(46),e(24)),r,"top"),startIslandTop4:this.generateWall(new t(e(44),e(26)),new t(e(46),e(26)),r,"top"),startIslandLeft1:this.generateWall(new t(e(47),e(23)),new t(e(47),e(24)),r,"left"),startIslandLeft2:this.generateWall(new t(e(47),e(26)),new t(e(47),e(26)),r,"left"),startIslandRight1:this.generateWall(new t(e(52),e(26)),new t(e(52),e(26)),r,"right"),startIslandBottom1:this.generateWall(new t(e(48),e(27)),new t(e(51),e(27)),r,"bottom"),startIslandBottom2:this.generateWall(new t(e(52),e(25)),new t(e(57),e(25)),r,"bottom"),startLakeTop1:this.generateWall(new t(e(43),e(19)),new t(e(58),e(19)),r,"top"),startLakeBottom1:this.generateWall(new t(e(43),e(29)),new t(e(58),e(29)),r,"bottom"),startLakeLeft1:this.generateWall(new t(e(43),e(20)),new t(e(43),e(24)),r,"left"),startLakeLeft2:this.generateWall(new t(e(43),e(26)),new t(e(43),e(28)),r,"left"),startLakeRight1:this.generateWall(new t(e(58),e(20)),new t(e(58),e(23)),r,"right"),startLakeRight2:this.generateWall(new t(e(58),e(25)),new t(e(58),e(28)),r,"right")};this.walls=new Set(Object.values(w).flat())}ready(){m.on(R,this,()=>{this.stopBackgroundSound();const o=new t(e(35),e(33)),n=l.loadHero();n&&(l.saveHero(n.level,o,n.exp),m.emit(b,new W(new t(0,0))))})}buildLevelGroupPurpleRod(){let o=new C(e(5),e(8),[{string:"Du hast nun die st\xE4rkste Waffe und keine Resource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Danke f\xFCr das Holz. Jetzt kannst du noch schneller Resourcen sammeln!  Sprich mit meinem Bruder wenn du Zeit findest.",requires:["STORY_01_PART_01"]},{string:"Bringe mir 5x Holz und ich gebe dir einen Zauberstab der mehr Schaden austeilt!",storyFlag:"STORY_01_PART_01"}]);l.isInEquipment("rodPurple")&&(o.position.x+=e(-1));const n=[o,new a(e(4),e(3)),new a(e(5),e(3)),new a(e(6),e(3)),new a(e(4),e(7)),new a(e(6),e(7)),new a(e(3),e(4)),new a(e(3),e(5)),new a(e(3),e(6)),new a(e(7),e(4)),new a(e(7),e(5)),new a(e(7),e(6))];if(!l.isInEquipment("rodPurple")){const s=new v(e(5),e(5),"rodPurple");n.push(s)}this.addChildrenGroup("lila Zauberstab",e(8),e(8),n,[{x1:4,x2:6,y1:0,y2:0},{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:0,x2:10,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}buildLevelGroupExit(){const o=[new p(e(3),e(3)),new _(e(7),e(6)),new h(e(3),e(6)),new h(e(4),e(6)),new h(e(5),e(6)),new h(e(6),e(6))];this.addChildrenGroup("Exit Gruppe",e(80),e(10),o,[{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:2,x2:8,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}loadLevelResources(){const o=E({levelId:"OutdoorLevel1",width:1600,height:800,seed:3,pathZones:[...this.noResourceZones,{x1:41,x2:48,y1:17,y2:17},{x1:41,x2:60,y1:18,y2:19},{x1:40,x2:61,y1:20,y2:28},{x1:41,x2:58,y1:29,y2:29},{x1:41,x2:53,y1:30,y2:30},{x1:42,x2:49,y1:31,y2:31},{x1:68,x2:80,y1:24,y2:25},{x1:25,x2:37,y1:23,y2:25},{x1:25,x2:26,y1:26,y2:39},{x1:8,x2:24,y1:40,y2:41},{x1:8,x2:9,y1:22,y2:39},{x1:10,x2:14,y1:22,y2:23}],density:{Tree:.5,Bush:.2,Stone:.1},border:32}),n=l.loadResources(this.levelId),s=o.map(i=>{const d=n.find(u=>u.x===i.x&&u.y===i.y&&u.type===i.type);return d?{...i,...d}:i});for(const i of s)if(i.hp>0)switch(i.type){case S:this.addChild(new T(i.x,i.y,i.hp));break;case k:this.addChild(new I(i.x,i.y,i.hp));break;case L:this.addChild(new P(i.x,i.y,i.hp));break}}loadLevelDeko(){const o=G({levelId:"OutdoorLevel1",width:1600,height:800,seed:2,pathZones:[...this.noResourceZones,{x1:41,x2:48,y1:17,y2:17},{x1:41,x2:60,y1:18,y2:19},{x1:40,x2:61,y1:20,y2:28},{x1:41,x2:58,y1:29,y2:29},{x1:41,x2:53,y1:30,y2:30},{x1:42,x2:49,y1:31,y2:31},{x1:68,x2:80,y1:24,y2:25},{x1:25,x2:37,y1:23,y2:25},{x1:25,x2:26,y1:26,y2:39},{x1:8,x2:24,y1:40,y2:41},{x1:8,x2:9,y1:22,y2:39},{x1:10,x2:14,y1:22,y2:23}],density:{animBushSmall:.02,animBush:.01},border:32});for(const n of o)this.addChild(new x(new t(n.x,n.y),n.type,this.getRandomDelay()))}getRandomDelay(o=4,n=7){const s=o*1e3,i=n*1e3;return Math.random()*(i-s)+s}loadStartLake(){for(let o=19;o<30;o++)for(let n=43;n<59;n++)o==25&&n==43||o==25&&n==44||o==25&&n==45||o==25&&n==46||o==25&&n==47||o==23&&n==48||o==24&&n==48||o==25&&n==48||o==26&&n==48||o==23&&n==49||o==24&&n==49||o==25&&n==49||o==26&&n==49||o==23&&n==50||o==24&&n==50||o==25&&n==50||o==26&&n==50||o==23&&n==51||o==24&&n==51||o==25&&n==51||o==26&&n==51||o==24&&n==52||o==24&&n==53||o==24&&n==54||o==24&&n==55||o==24&&n==56||o==24&&n==57||o==24&&n==58||this.addChild(new x(new t(e(n),e(o)),"animWater"))}}
