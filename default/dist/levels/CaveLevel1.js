"use strict";import{gridCells as t,TILE_SIZE as a}from"../helpers/grid.js";import{resources as h}from"../Resource.js";import{Vector2 as o}from"../Vector2.js";import{Sprite as m}from"../Sprite.js";import{Level as p}from"../objects/Level/Level.js";import{Exit as c}from"../objects/Exit/Exit.js";import{Hero as f}from"../objects/Hero/Hero.js";import{events as u,HERO_EXITS as w,CHANGE_LEVEL as v}from"../Events.js";import{OutdoorLevel1 as S}from"./OutdoorLevel1.js";import{Npc as R}from"../objects/Npc/Npc.js";import{Item as g}from"../objects/Item/Item.js";import{SaveGame as d}from"../SaveGame.js";import{generateDefaultResources as b}from"../helpers/generateResources.js";import{Tree as x}from"./parts/Tree/Tree.js";import{Bush as y}from"./parts/Bush/Bush.js";import{Stone as L}from"./parts/Stone/Stone.js";export class CaveLevel1 extends p{constructor({position:r,heroPosition:i}){super(r,"./sounds/levels/CaveLevel1.mp3",.2);this.defaultHeroPosition=new o(t(5),t(2));this.levelId="CaveLevel1";this.initBackgroundSound(),this.background=new m({resource:h.images.caveSky,frameSize:new o(320,180),position:new o(0,0)});const s=new m({resource:h.images.caveGround,frameSize:new o(320,180),position:new o(0,0)});this.addChild(s),this.checkGameProgress(),this.buildLevelGroupRedRod(),this.loadLevelRessources(),this.heroStartPosition=d.loadHero(this.levelId,i??this.defaultHeroPosition);const e=new f(this.heroStartPosition.x,this.heroStartPosition.y);this.addChild(e);const n={right:this.generateWall(new o(288,16),new o(288,112),a,"right"),left:this.generateWall(new o(16,16),new o(16,112),a,"left"),top:this.generateWall(new o(32,0),new o(272,0),a,"top"),bottom:this.generateWall(new o(32,128),new o(272,128),a,"bottom"),stone:["144,16","192,32","208,32","208,48","256,80","32,64"],littleStone:["48,64","48,80"],squares:["48,13","64,16","80,48","96,48","128,48","112,64","96,64","192,80","208,80","224,96"],water:["240,32","256,32","208,96","192,96","176,96","128,96","112,96","96,96"]};this.walls=new Set(Object.values(n).flat())}ready(){u.on(w,this,()=>{this.stopBackgroundSound(),u.emit(v,new S({position:new o(t(0),t(0)),heroPosition:new o(t(11),t(10))}))})}buildLevelGroupRedRod(){let r=new R(t(7),t(2),[{string:"Du hast nun die st\xE4rkste Waffe und keine Ressource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Bringe mir 20x Bl\xE4tter, 25x Holz, 10x Steine und die ultimative Waffe geh\xF6rt dir!",requires:["STORY_01_PART_01"],storyFlag:"STORY_02_PART_01"},{string:"Sprich zuerst mit meinem Bruder!"}]);d.isInEquipment("rodRed")&&(r.position.x+=t(-1));const i=[r,new c(t(17),t(7))];if(!d.isInEquipment("rodRed")){const s=new g(t(7),t(3),"rodRed");i.push(s)}this.addChildrenGroup("roter Zauberstab",t(0),t(0),i,[{x1:0,x2:10,y1:0,y2:10}])}loadLevelRessources(){const r=b({levelId:"CaveLevel1",width:320,height:180,seed:1,pathZones:[...this.noRessourceZones],density:{Tree:0,Bush:0,Stone:0},border:0}),i=d.loadResources(this.levelId),s=r.map(e=>{const n=i.find(l=>l.x===e.x&&l.y===e.y&&l.type===e.type);return n?{...e,...n}:e});for(const e of s)if(e.hp>0)switch(e.type){case"Tree":this.addChild(new x(e.x,e.y,e.hp));break;case"Bush":this.addChild(new y(e.x,e.y,e.hp));break;case"Stone":this.addChild(new L(e.x,e.y,e.hp));break}}}
