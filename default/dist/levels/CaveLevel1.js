"use strict";import{gridCells as e,TILE_SIZE as h}from"../helpers/grid.js";import{resources as m}from"../Resource.js";import{Vector2 as r}from"../Vector2.js";import{Sprite as u}from"../Sprite.js";import{Level as c}from"../objects/Level/Level.js";import{Exit as y}from"../objects/Exit/Exit.js";import{Hero as w}from"../objects/Hero/Hero.js";import{events as p,HERO_EXITS as f,CHANGE_LEVEL as v}from"../Events.js";import{OutdoorLevel1 as S}from"./OutdoorLevel1.js";import{Npc as R}from"../objects/Npc/Npc.js";import{BUSH as g,Item as b,STONE as L,TREE as E}from"../objects/Item/Item.js";import{SaveGame as d}from"../SaveGame.js";import{generateDefaultResources as G}from"../helpers/generateResources.js";import{Tree as _}from"./parts/Tree/Tree.js";import{Bush as P}from"./parts/Bush/Bush.js";import{Stone as T}from"./parts/Stone/Stone.js";import{Square as i}from"./parts/Square/Square.js";export class CaveLevel1 extends c{constructor(s){super(s,"./sounds/levels/CaveLevel1.mp3",.2);this.levelId="CaveLevel1";this.defaultHeroPosition=new r(e(16),e(6));this.initBackgroundSound(),this.background=new u({resource:m.images.caveSky,frameSize:new r(320,180),position:new r(0,0)});const o=new u({resource:m.images.desertGround,frameSize:new r(1600,1600),position:new r(0,0)});this.addChild(o),this.checkGameProgress(),this.buildLevelGroupRedRod(),this.buildLevelGroupExit(),this.loadLevelResources(),this.heroStartPosition=this.defaultHeroPosition;const n=d.loadHero();let t=0,a=0;n&&(this.heroStartPosition=n.pos??this.defaultHeroPosition,t=n.exp,a=n.level);const l=new w(this.heroStartPosition.x,this.heroStartPosition.y,t,a);this.addChild(l);const x={right:this.generateWall(new r(1568,32),new r(1568,1564),h,"right"),left:this.generateWall(new r(16,32),new r(16,1564),h,"left"),top:this.generateWall(new r(32,16),new r(1568,16),h,"top"),bottom:this.generateWall(new r(32,1564),new r(1568,1564),h,"bottom")};this.walls=new Set(Object.values(x).flat())}ready(){p.on(f,this,()=>{this.stopBackgroundSound();const s=new r(e(84),e(14)),o=d.loadHero();o&&(d.saveHero(o.level,s,o.exp),p.emit(v,new S(new r(0,0))))})}buildLevelGroupRedRod(){let s=new R(e(5),e(8),[{string:"Du hast nun die st\xE4rkste Waffe und keine Resource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Bringe mir 20x Bl\xE4tter, 25x Holz, 10x Steine und die ultimative Waffe geh\xF6rt dir!",requires:["STORY_01_PART_01"],storyFlag:"STORY_02_PART_01"},{string:"Sprich zuerst mit meinem Bruder!"}]);d.isInEquipment("rodRed")&&(s.position.x+=e(-1));const o="desert",n=[s,new i(e(4),e(3),o),new i(e(5),e(3),o),new i(e(6),e(3),o),new i(e(4),e(7),o),new i(e(6),e(7),o),new i(e(3),e(4),o),new i(e(3),e(5),o),new i(e(3),e(6),o),new i(e(7),e(4),o),new i(e(7),e(5),o),new i(e(7),e(6),o)];if(!d.isInEquipment("rodRed")){const t=new b(e(5),e(5),"rodRed");n.push(t)}this.addChildrenGroup("roter Zauberstab",e(8),e(8),n,[{x1:4,x2:6,y1:0,y2:0},{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:0,x2:10,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:10}])}buildLevelGroupExit(){const s=[new y(e(4),e(4))];this.addChildrenGroup("Exit Gruppe",e(30),e(30),s,[{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:2,x2:8,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}loadLevelResources(){const s=G({levelId:"CaveLevel1",width:1600,height:1600,seed:1,pathZones:[...this.noResourceZones,{x1:30,x2:32,y1:12,y2:32},{x1:20,x2:29,y1:12,y2:13}],density:{Tree:.2,Bush:.3,Stone:.1},border:32}),o=d.loadResources(this.levelId),n=s.map(t=>{const a=o.find(l=>l.x===t.x&&l.y===t.y&&l.type===t.type);return a?{...t,...a}:t});for(const t of n)if(t.hp>0)switch(t.type){case g:this.addChild(new P(t.x,t.y,t.hp,"desert"));break;case E:this.addChild(new _(t.x,t.y,t.hp,"desert"));break;case L:this.addChild(new T(t.x,t.y,t.hp,"desert"));break}}}
