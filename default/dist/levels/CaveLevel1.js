"use strict";import{gridCells as e,TILE_SIZE as h}from"../helpers/grid.js";import{resources as p}from"../Resource.js";import{Vector2 as r}from"../Vector2.js";import{Sprite as m}from"../Sprite.js";import{Level as y}from"../objects/Level/Level.js";import{Exit as w}from"../objects/Exit/Exit.js";import{Hero as f}from"../objects/Hero/Hero.js";import{events as u,HERO_EXITS as v,CHANGE_LEVEL as S}from"../Events.js";import{OutdoorLevel1 as R}from"./OutdoorLevel1.js";import{Npc as g}from"../objects/Npc/Npc.js";import{BUSH as b,Item as L,STONE as P,TREE as E}from"../objects/Item/Item.js";import{SaveGame as a}from"../SaveGame.js";import{generateDefaultResources as G}from"../helpers/generateResources.js";import{Tree as _}from"./parts/Tree/Tree.js";import{Bush as T}from"./parts/Bush/Bush.js";import{Stone as C}from"./parts/Stone/Stone.js";import{Square as s}from"./parts/Square/Square.js";export class CaveLevel1 extends y{constructor({position:i,heroPosition:o}){super(i,"./sounds/levels/CaveLevel1.mp3",.2);this.defaultHeroPosition=new r(e(16),e(6));this.levelId="CaveLevel1";this.initBackgroundSound(),this.background=new m({resource:p.images.caveSky,frameSize:new r(320,180),position:new r(0,0)});const n=new m({resource:p.images.desertGround,frameSize:new r(1600,1600),position:new r(0,0)});this.addChild(n),this.checkGameProgress(),this.buildLevelGroupRedRod(),this.buildLevelGroupExit(),this.loadLevelResources(),this.heroStartPosition=this.defaultHeroPosition;const t=a.loadHero();let l=0,d=0;t&&(this.heroStartPosition=t.pos??this.defaultHeroPosition,l=t.exp,d=t.level);const x=new f(this.heroStartPosition.x,this.heroStartPosition.y,l,d);this.addChild(x);const c={right:this.generateWall(new r(1568,32),new r(1568,1564),h,"right"),left:this.generateWall(new r(16,32),new r(16,1564),h,"left"),top:this.generateWall(new r(32,16),new r(1568,16),h,"top"),bottom:this.generateWall(new r(32,1564),new r(1568,1564),h,"bottom")};this.walls=new Set(Object.values(c).flat())}ready(){u.on(v,this,()=>{this.stopBackgroundSound();const i=new r(e(11),e(8)),o=a.loadHero();o&&(a.saveHero(o.level,i,o.exp),u.emit(S,new R({position:new r(e(0),e(0)),heroPosition:i})))})}buildLevelGroupRedRod(){let i=new g(e(5),e(8),[{string:"Du hast nun die st\xE4rkste Waffe und keine Resource kann dich aufhalten",requires:["STORY_01_PART_01","STORY_02_PART_01"]},{string:"Bringe mir 20x Bl\xE4tter, 25x Holz, 10x Steine und die ultimative Waffe geh\xF6rt dir!",requires:["STORY_01_PART_01"],storyFlag:"STORY_02_PART_01"},{string:"Sprich zuerst mit meinem Bruder!"}]);a.isInEquipment("rodRed")&&(i.position.x+=e(-1));const o="desert",n=[i,new s(e(4),e(3),o),new s(e(5),e(3),o),new s(e(6),e(3),o),new s(e(4),e(7),o),new s(e(6),e(7),o),new s(e(3),e(4),o),new s(e(3),e(5),o),new s(e(3),e(6),o),new s(e(7),e(4),o),new s(e(7),e(5),o),new s(e(7),e(6),o)];if(!a.isInEquipment("rodRed")){const t=new L(e(5),e(5),"rodRed");n.push(t)}this.addChildrenGroup("roter Zauberstab",e(8),e(8),n,[{x1:4,x2:6,y1:0,y2:0},{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:0,x2:10,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:10}])}buildLevelGroupExit(){const i=[new w(e(4),e(4))];this.addChildrenGroup("Exit Gruppe",e(30),e(30),i,[{x1:3,x2:7,y1:1,y2:1},{x1:2,x2:8,y1:2,y2:2},{x1:1,x2:9,y1:3,y2:3},{x1:2,x2:8,y1:4,y2:6},{x1:1,x2:9,y1:7,y2:7},{x1:2,x2:8,y1:8,y2:8},{x1:3,x2:7,y1:9,y2:9},{x1:4,x2:6,y1:10,y2:13}])}loadLevelResources(){const i=G({levelId:"CaveLevel1",width:1600,height:1600,seed:1,pathZones:[...this.noResourceZones,{x1:30,x2:32,y1:12,y2:32},{x1:20,x2:29,y1:12,y2:13}],density:{Tree:.2,Bush:.3,Stone:.1},border:32}),o=a.loadResources(this.levelId),n=i.map(t=>{const l=o.find(d=>d.x===t.x&&d.y===t.y&&d.type===t.type);return l?{...t,...l}:t});for(const t of n)if(t.hp>0)switch(t.type){case b:this.addChild(new T(t.x,t.y,t.hp,"desert"));break;case E:this.addChild(new _(t.x,t.y,t.hp,"desert"));break;case P:this.addChild(new C(t.x,t.y,t.hp,"desert"));break}}}
