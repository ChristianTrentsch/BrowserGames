"use strict";export const LEFT="LEFT",RIGHT="RIGHT",UP="UP",DOWN="DOWN",SPACE="SPACE",ITEM1="ITEM1",ITEM2="ITEM2",RELOAD="RELOAD",ATTACK="ATTACK";export class Input{constructor(){this.keyToDirection={ArrowLeft:LEFT,ArrowRight:RIGHT,ArrowUp:UP,ArrowDown:DOWN,KeyA:LEFT,KeyD:RIGHT,KeyW:UP,KeyS:DOWN};this.currentInputMode="keyboard";this.heldDirections=[],this.keys={ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,Space:!1,KeyE:!1,KeyR:!1,KeyQ:!1,KeyF:!1,KeyM:!1,KeyI:!1},this.lastKeys={...this.keys},document.addEventListener("keydown",t=>{this.currentInputMode="keyboard";const e=t.code;[" ","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&t.preventDefault(),e in this.keys&&(this.keys[e]=!0,e in this.keyToDirection&&this.onArrowPressed(this.keyToDirection[e]))}),document.addEventListener("keyup",t=>{this.currentInputMode="keyboard";const e=t.code;e in this.keys&&(this.keys[e]=!1,e in this.keyToDirection&&this.onArrowReleased(this.keyToDirection[e]))}),window.addEventListener("gamepadconnected",t=>{}),window.addEventListener("gamepaddisconnected",t=>{})}get direction(){return this.heldDirections[0]}update(){this.lastKeys={...this.keys},this.pollGamepad()}getActionJustPressed(t){let e=!1;return this.keys[t]&&!this.lastKeys[t]&&(e=!0),e}onArrowPressed(t){this.heldDirections.indexOf(t)===-1&&this.heldDirections.unshift(t)}onArrowReleased(t){const e=this.heldDirections.indexOf(t);e!==-1&&this.heldDirections.splice(e,1)}pollGamepad(){const t=navigator.getGamepads();if(!t)return;const e=t[0];if(!e)return;const[r,o]=e.axes,s=.4;(e.buttons.some(i=>i.pressed)||Math.abs(r)>s||Math.abs(o)>s)&&(this.currentInputMode="controller"),this.currentInputMode==="controller"&&(this.resetDirectionsFromGamepad(),r&&(r<-s&&this.onArrowPressed("LEFT"),r>s&&this.onArrowPressed("RIGHT")),o&&(o<-s&&this.onArrowPressed("UP"),o>s&&this.onArrowPressed("DOWN")),e.buttons[14]?.pressed&&this.onArrowPressed("LEFT"),e.buttons[15]?.pressed&&this.onArrowPressed("RIGHT"),e.buttons[12]?.pressed&&this.onArrowPressed("UP"),e.buttons[13]?.pressed&&this.onArrowPressed("DOWN"),this.mapButton(e.buttons[0],"Space"),this.mapButton(e.buttons[1],"KeyF"),this.mapButton(e.buttons[2],"KeyR"),this.mapButton(e.buttons[3],"KeyQ"),this.mapButton(e.buttons[8],"KeyM"),this.mapButton(e.buttons[9],"KeyE"))}mapButton(t,e){t&&(t.pressed?this.keys[e]||(this.keys[e]=!0,e in this.keyToDirection&&this.onArrowPressed(this.keyToDirection[e])):this.keys[e]&&(this.keys[e]=!1,e in this.keyToDirection&&this.onArrowPressed(this.keyToDirection[e])))}resetDirectionsFromGamepad(){["LEFT","RIGHT","UP","DOWN"].forEach(t=>this.onArrowReleased(t))}}
