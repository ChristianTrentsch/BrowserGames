"use strict";export const LEFT="LEFT",RIGHT="RIGHT",UP="UP",DOWN="DOWN",SPACE="SPACE",ITEM1="ITEM1",ITEM2="ITEM2",RELOAD="RELOAD",ATTACK="ATTACK";export class Input{constructor(){this.keyToDirection={ArrowLeft:LEFT,ArrowRight:RIGHT,ArrowUp:UP,ArrowDown:DOWN,KeyA:LEFT,KeyD:RIGHT,KeyW:UP,KeyS:DOWN,Space:SPACE,KeyE:ITEM1,KeyQ:ITEM2,KeyR:RELOAD,KeyF:ATTACK};this.heldDirections=[],this.keys={ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1,KeyW:!1,KeyA:!1,KeyS:!1,KeyD:!1,Space:!1,KeyE:!1,KeyR:!1,KeyQ:!1,KeyF:!1},this.lastKeys={...this.keys},document.addEventListener("keydown",t=>{const e=t.code;[" ","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t.key)&&t.preventDefault(),e in this.keys&&(this.keys[e]=!0,this.onArrowPressed(this.keyToDirection[e]))}),document.addEventListener("keyup",t=>{const e=t.code;e in this.keys&&(this.keys[e]=!1,this.onArrowReleased(this.keyToDirection[e]))}),window.addEventListener("gamepadconnected",t=>{console.log("Gamepad verbunden:",t.gamepad)}),window.addEventListener("gamepaddisconnected",t=>{console.log("Gamepad getrennt:",t.gamepad)})}get direction(){return this.heldDirections[0]}update(){this.lastKeys={...this.keys},this.pollGamepad()}getActionJustPressed(t){let e=!1;return this.keys[t]&&!this.lastKeys[t]&&(e=!0),e}onArrowPressed(t){this.heldDirections.indexOf(t)===-1&&this.heldDirections.unshift(t)}onArrowReleased(t){const e=this.heldDirections.indexOf(t);e!==-1&&this.heldDirections.splice(e,1)}pollGamepad(){const t=navigator.getGamepads();if(!t)return;const e=t[0];if(!e)return;const o=.4;this.resetDirectionsFromGamepad();const[s,i]=e.axes;s&&(s<-o&&this.onArrowPressed("LEFT"),s>o&&this.onArrowPressed("RIGHT")),i&&(i<-o&&this.onArrowPressed("UP"),i>o&&this.onArrowPressed("DOWN")),e.buttons[14]?.pressed&&this.onArrowPressed("LEFT"),e.buttons[15]?.pressed&&this.onArrowPressed("RIGHT"),e.buttons[12]?.pressed&&this.onArrowPressed("UP"),e.buttons[13]?.pressed&&this.onArrowPressed("DOWN"),this.mapButton(e.buttons[0],"Space",this.keyToDirection),this.mapButton(e.buttons[1],"KeyF",this.keyToDirection),this.mapButton(e.buttons[2],"KeyQ",this.keyToDirection),this.mapButton(e.buttons[3],"KeyE",this.keyToDirection),this.mapButton(e.buttons[9],"KeyR",this.keyToDirection)}mapButton(t,e,o){if(t){if(t.pressed){if(!this.keys[e]){this.keys[e]=!0;const s=o[e];s&&this.onArrowPressed(s)}}else if(this.keys[e]){this.keys[e]=!1;const s=o[e];s&&this.onArrowReleased(s)}}}resetDirectionsFromGamepad(){["LEFT","RIGHT","UP","DOWN"].forEach(t=>this.onArrowReleased(t))}}
